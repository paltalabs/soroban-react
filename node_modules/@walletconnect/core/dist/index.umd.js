(function(W,ot){typeof exports=="object"&&typeof module<"u"?ot(exports):typeof define=="function"&&define.amd?define(["exports"],ot):(W=typeof globalThis<"u"?globalThis:W||self,ot(W["@walletconnect/core"]={}))})(this,function(W){"use strict";var ot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lt(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var ht={exports:{}},Vt=typeof Reflect=="object"?Reflect:null,di=Vt&&typeof Vt.apply=="function"?Vt.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},Dr;Vt&&typeof Vt.ownKeys=="function"?Dr=Vt.ownKeys:Object.getOwnPropertySymbols?Dr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Dr=function(e){return Object.getOwnPropertyNames(e)};function ja(t){console&&console.warn&&console.warn(t)}var gi=Number.isNaN||function(e){return e!==e};function Ie(){Ie.init.call(this)}ht.exports=Ie,ht.exports.once=Ka,Ie.EventEmitter=Ie,Ie.prototype._events=void 0,Ie.prototype._eventsCount=0,Ie.prototype._maxListeners=void 0;var yi=10;function Sr(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ie,"defaultMaxListeners",{enumerable:!0,get:function(){return yi},set:function(t){if(typeof t!="number"||t<0||gi(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");yi=t}}),Ie.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ie.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||gi(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _i(t){return t._maxListeners===void 0?Ie.defaultMaxListeners:t._maxListeners}Ie.prototype.getMaxListeners=function(){return _i(this)},Ie.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var f;if(r.length>0&&(f=r[0]),f instanceof Error)throw f;var u=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw u.context=f,u}var h=s[e];if(h===void 0)return!1;if(typeof h=="function")di(h,this,r);else for(var c=h.length,l=mi(h,c),n=0;n<c;++n)di(l[n],this,r);return!0};function pi(t,e,r,n){var i,s,f;if(Sr(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),f=s[e]),f===void 0)f=s[e]=r,++t._eventsCount;else if(typeof f=="function"?f=s[e]=n?[r,f]:[f,r]:n?f.unshift(r):f.push(r),i=_i(t),i>0&&f.length>i&&!f.warned){f.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=f.length,ja(u)}return t}Ie.prototype.addListener=function(e,r){return pi(this,e,r,!1)},Ie.prototype.on=Ie.prototype.addListener,Ie.prototype.prependListener=function(e,r){return pi(this,e,r,!0)};function Fa(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function bi(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=Fa.bind(n);return i.listener=r,n.wrapFn=i,i}Ie.prototype.once=function(e,r){return Sr(r),this.on(e,bi(this,e,r)),this},Ie.prototype.prependOnceListener=function(e,r){return Sr(r),this.prependListener(e,bi(this,e,r)),this},Ie.prototype.removeListener=function(e,r){var n,i,s,f,u;if(Sr(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(s=-1,f=n.length-1;f>=0;f--)if(n[f]===r||n[f].listener===r){u=n[f].listener,s=f;break}if(s<0)return this;s===0?n.shift():Ba(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,u||r)}return this},Ie.prototype.off=Ie.prototype.removeListener,Ie.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),f;for(i=0;i<s.length;++i)f=s[i],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function vi(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?za(i):mi(i,i.length)}Ie.prototype.listeners=function(e){return vi(this,e,!0)},Ie.prototype.rawListeners=function(e){return vi(this,e,!1)},Ie.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):wi.call(t,e)},Ie.prototype.listenerCount=wi;function wi(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Ie.prototype.eventNames=function(){return this._eventsCount>0?Dr(this._events):[]};function mi(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function Ba(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function za(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Ka(t,e){return new Promise(function(r,n){function i(f){t.removeListener(e,s),n(f)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}Ei(t,e,s,{once:!0}),e!=="error"&&Ha(t,i,{once:!0})})}function Ha(t,e,r){typeof t.on=="function"&&Ei(t,"error",e,r)}function Ei(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}const Ga=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Va=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Wa=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function qa(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Ya(t);return}return e}function Ya(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Or(t,e={}){if(typeof t!="string")return t;const r=t.trim();if(t[0]==='"'&&t.at(-1)==='"'&&!t.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!Wa.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Ga.test(t)||Va.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,qa)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function ka(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Ke(t,...e){try{return ka(t(...e))}catch(r){return Promise.reject(r)}}function Xa(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Ja(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Ir(t){if(Xa(t))return String(t);if(Ja(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Ir(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Di(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const on="base64:";function Qa(t){if(typeof t=="string")return t;Di();const e=Buffer.from(t).toString("base64");return on+e}function Za(t){return typeof t!="string"||!t.startsWith(on)?t:(Di(),Buffer.from(t.slice(on.length),"base64"))}function at(t){return t?t.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function ec(...t){return at(t.join(":"))}function Tr(t){return t=at(t),t?t+":":""}function Z0(t){return t}const tc="memory",rc=()=>{const t=new Map;return{name:tc,options:{},hasItem(e){return t.has(e)},getItem(e){return t.get(e)||null},getItemRaw(e){return t.get(e)||null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return Array.from(t.keys())},clear(){t.clear()},dispose(){t.clear()}}};function nc(t={}){const e={mounts:{"":t.driver||rc()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=c=>{for(const l of e.mountpoints)if(c.startsWith(l))return{base:l,relativeKey:c.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:c,driver:e.mounts[""]}},n=(c,l)=>e.mountpoints.filter(p=>p.startsWith(c)||l&&c.startsWith(p)).map(p=>({relativeBase:c.length>p.length?c.slice(p.length):void 0,mountpoint:p,driver:e.mounts[p]})),i=(c,l)=>{if(e.watching){l=at(l);for(const p of e.watchListeners)p(c,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await Si(e.mounts[c],i,c)}},f=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},u=(c,l,p)=>{const _=new Map,b=O=>{let A=_.get(O.base);return A||(A={driver:O.driver,base:O.base,items:[]},_.set(O.base,A)),A};for(const O of c){const A=typeof O=="string",N=at(A?O:O.key),G=A?void 0:O.value,E=A||!O.options?l:{...l,...O.options},R=r(N);b(R).items.push({key:N,value:G,relativeKey:R.relativeKey,options:E})}return Promise.all([..._.values()].map(O=>p(O))).then(O=>O.flat())},h={hasItem(c,l={}){c=at(c);const{relativeKey:p,driver:_}=r(c);return Ke(_.hasItem,p,l)},getItem(c,l={}){c=at(c);const{relativeKey:p,driver:_}=r(c);return Ke(_.getItem,p,l).then(b=>Or(b))},getItems(c,l){return u(c,l,p=>p.driver.getItems?Ke(p.driver.getItems,p.items.map(_=>({key:_.relativeKey,options:_.options})),l).then(_=>_.map(b=>({key:ec(p.base,b.key),value:Or(b.value)}))):Promise.all(p.items.map(_=>Ke(p.driver.getItem,_.relativeKey,_.options).then(b=>({key:_.key,value:Or(b)})))))},getItemRaw(c,l={}){c=at(c);const{relativeKey:p,driver:_}=r(c);return _.getItemRaw?Ke(_.getItemRaw,p,l):Ke(_.getItem,p,l).then(b=>Za(b))},async setItem(c,l,p={}){if(l===void 0)return h.removeItem(c);c=at(c);const{relativeKey:_,driver:b}=r(c);b.setItem&&(await Ke(b.setItem,_,Ir(l),p),b.watch||i("update",c))},async setItems(c,l){await u(c,l,async p=>{p.driver.setItems&&await Ke(p.driver.setItems,p.items.map(_=>({key:_.relativeKey,value:Ir(_.value),options:_.options})),l),p.driver.setItem&&await Promise.all(p.items.map(_=>Ke(p.driver.setItem,_.relativeKey,Ir(_.value),_.options)))})},async setItemRaw(c,l,p={}){if(l===void 0)return h.removeItem(c,p);c=at(c);const{relativeKey:_,driver:b}=r(c);if(b.setItemRaw)await Ke(b.setItemRaw,_,l,p);else if(b.setItem)await Ke(b.setItem,_,Qa(l),p);else return;b.watch||i("update",c)},async removeItem(c,l={}){typeof l=="boolean"&&(l={removeMeta:l}),c=at(c);const{relativeKey:p,driver:_}=r(c);_.removeItem&&(await Ke(_.removeItem,p,l),(l.removeMeta||l.removeMata)&&await Ke(_.removeItem,p+"$",l),_.watch||i("remove",c))},async getMeta(c,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),c=at(c);const{relativeKey:p,driver:_}=r(c),b=Object.create(null);if(_.getMeta&&Object.assign(b,await Ke(_.getMeta,p,l)),!l.nativeOnly){const O=await Ke(_.getItem,p+"$",l).then(A=>Or(A));O&&typeof O=="object"&&(typeof O.atime=="string"&&(O.atime=new Date(O.atime)),typeof O.mtime=="string"&&(O.mtime=new Date(O.mtime)),Object.assign(b,O))}return b},setMeta(c,l,p={}){return this.setItem(c+"$",l,p)},removeMeta(c,l={}){return this.removeItem(c+"$",l)},async getKeys(c,l={}){c=Tr(c);const p=n(c,!0);let _=[];const b=[];for(const O of p){const N=(await Ke(O.driver.getKeys,O.relativeBase,l)).map(G=>O.mountpoint+at(G)).filter(G=>!_.some(E=>G.startsWith(E)));b.push(...N),_=[O.mountpoint,..._.filter(G=>!G.startsWith(O.mountpoint))]}return c?b.filter(O=>O.startsWith(c)&&!O.endsWith("$")):b.filter(O=>!O.endsWith("$"))},async clear(c,l={}){c=Tr(c),await Promise.all(n(c,!1).map(async p=>{if(p.driver.clear)return Ke(p.driver.clear,p.relativeBase,l);if(p.driver.removeItem){const _=await p.driver.getKeys(p.relativeBase||"",l);return Promise.all(_.map(b=>p.driver.removeItem(b,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>Oi(c)))},async watch(c){return await s(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==c),e.watchListeners.length===0&&await f()}},async unwatch(){e.watchListeners=[],await f()},mount(c,l){if(c=Tr(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((p,_)=>_.length-p.length)),e.mounts[c]=l,e.watching&&Promise.resolve(Si(l,i,c)).then(p=>{e.unwatch[c]=p}).catch(console.error),h},async unmount(c,l=!0){c=Tr(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&(e.unwatch[c](),delete e.unwatch[c]),l&&await Oi(e.mounts[c]),e.mountpoints=e.mountpoints.filter(p=>p!==c),delete e.mounts[c])},getMount(c=""){c=at(c)+":";const l=r(c);return{driver:l.driver,base:l.base}},getMounts(c="",l={}){return c=at(c),n(c,l.parents).map(_=>({driver:_.driver,base:_.mountpoint}))}};return h}function Si(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function Oi(t){typeof t.dispose=="function"&&await Ke(t.dispose)}function Nt(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Ii(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const n=Nt(r);return(i,s)=>n.then(f=>s(f.transaction(e,i).objectStore(e)))}let an;function tr(){return an||(an=Ii("keyval-store","keyval")),an}function Ti(t,e=tr()){return e("readonly",r=>Nt(r.get(t)))}function ic(t,e,r=tr()){return r("readwrite",n=>(n.put(e,t),Nt(n.transaction)))}function sc(t,e=tr()){return e("readwrite",r=>(r.delete(t),Nt(r.transaction)))}function oc(t=tr()){return t("readwrite",e=>(e.clear(),Nt(e.transaction)))}function ac(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Nt(t.transaction)}function cc(t=tr()){return t("readonly",e=>{if(e.getAllKeys)return Nt(e.getAllKeys());const r=[];return ac(e,n=>r.push(n.key)).then(()=>r)})}const uc=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),fc=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function xr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return fc(t)}catch{return t}}function rr(t){return typeof t=="string"?t:uc(t)||""}const hc="idb-keyval";var lc=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=Ii(t.dbName,t.storeName)),{name:hc,options:t,async hasItem(i){return!(typeof await Ti(r(i),n)>"u")},async getItem(i){return await Ti(r(i),n)??null},setItem(i,s){return ic(r(i),s,n)},removeItem(i){return sc(r(i),n)},getKeys(){return cc(n)},clear(){return oc(n)}}};const dc="WALLET_CONNECT_V2_INDEXED_DB",gc="keyvaluestorage";class yc{constructor(){this.indexedDb=nc({driver:lc({dbName:dc,storeName:gc})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,rr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rr={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof cn<"u"&&cn.localStorage?Rr.exports=cn.localStorage:typeof window<"u"&&window.localStorage?Rr.exports=window.localStorage:Rr.exports=new e})();function _c(t){var e;return[t[0],xr((e=t[1])!=null?e:"")]}class pc{constructor(){this.localStorage=Rr.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(_c)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return xr(r)}async setItem(e,r){this.localStorage.setItem(e,rr(r))}async removeItem(e){this.localStorage.removeItem(e)}}const bc="wc_storage_version",xi=1,vc=async(t,e,r)=>{const n=bc,i=await e.getItem(n);if(i&&i>=xi){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const f=[];for(;s.length;){const u=s.shift();if(!u)continue;const h=u.toLowerCase();if(h.includes("wc@")||h.includes("walletconnect")||h.includes("wc_")||h.includes("wallet_connect")){const c=await t.getItem(u);await e.setItem(u,c),f.push(u)}}await e.setItem(n,xi),r(e),wc(t,f)},wc=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class mc{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new pc;this.storage=e;try{const r=new yc;vc(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}var Wt={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var un=function(t,e){return un=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},un(t,e)};function Ec(t,e){un(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var fn=function(){return fn=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},fn.apply(this,arguments)};function Dc(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Sc(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(i<3?f(s):i>3?f(e,r,s):f(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Oc(t,e){return function(r,n){e(r,n,t)}}function Ic(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Tc(t,e,r,n){function i(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(n.next(l))}catch(p){f(p)}}function h(l){try{c(n.throw(l))}catch(p){f(p)}}function c(l){l.done?s(l.value):i(l.value).then(u,h)}c((n=n.apply(t,e||[])).next())})}function xc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Rc(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Cc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function hn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ri(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],f;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(u){f={error:u}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function Ac(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ri(arguments[e]));return t}function Pc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,i++)n[i]=s[f];return n}function nr(t){return this instanceof nr?(this.v=t,this):new nr(t)}function Lc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},f("next"),f("throw"),f("return"),i[Symbol.asyncIterator]=function(){return this},i;function f(_){n[_]&&(i[_]=function(b){return new Promise(function(O,A){s.push([_,b,O,A])>1||u(_,b)})})}function u(_,b){try{h(n[_](b))}catch(O){p(s[0][3],O)}}function h(_){_.value instanceof nr?Promise.resolve(_.value.v).then(c,l):p(s[0][2],_)}function c(_){u("next",_)}function l(_){u("throw",_)}function p(_,b){_(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function Nc(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(f){return(r=!r)?{value:nr(t[i](f)),done:i==="return"}:s?s(f):f}:s}}function Uc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof hn=="function"?hn(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),i(u,h,f.done,f.value)})}}function i(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function Mc(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function $c(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function jc(t){return t&&t.__esModule?t:{default:t}}function Fc(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Bc(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var zc=Object.freeze({__proto__:null,__extends:Ec,get __assign(){return fn},__rest:Dc,__decorate:Sc,__param:Oc,__metadata:Ic,__awaiter:Tc,__generator:xc,__createBinding:Rc,__exportStar:Cc,__values:hn,__read:Ri,__spread:Ac,__spreadArrays:Pc,__await:nr,__asyncGenerator:Lc,__asyncDelegator:Nc,__asyncValues:Uc,__makeTemplateObject:Mc,__importStar:$c,__importDefault:jc,__classPrivateFieldGet:Fc,__classPrivateFieldSet:Bc}),Cr=Lt(zc),ir={},ae={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var ln=function(t,e){return ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},ln(t,e)};function Kc(t,e){ln(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var dn=function(){return dn=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},dn.apply(this,arguments)};function Hc(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Gc(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(i<3?f(s):i>3?f(e,r,s):f(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Vc(t,e){return function(r,n){e(r,n,t)}}function Wc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function qc(t,e,r,n){function i(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(n.next(l))}catch(p){f(p)}}function h(l){try{c(n.throw(l))}catch(p){f(p)}}function c(l){l.done?s(l.value):i(l.value).then(u,h)}c((n=n.apply(t,e||[])).next())})}function Yc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function kc(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Xc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function gn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ci(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],f;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(u){f={error:u}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function Jc(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ci(arguments[e]));return t}function Qc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,i++)n[i]=s[f];return n}function sr(t){return this instanceof sr?(this.v=t,this):new sr(t)}function Zc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},f("next"),f("throw"),f("return"),i[Symbol.asyncIterator]=function(){return this},i;function f(_){n[_]&&(i[_]=function(b){return new Promise(function(O,A){s.push([_,b,O,A])>1||u(_,b)})})}function u(_,b){try{h(n[_](b))}catch(O){p(s[0][3],O)}}function h(_){_.value instanceof sr?Promise.resolve(_.value.v).then(c,l):p(s[0][2],_)}function c(_){u("next",_)}function l(_){u("throw",_)}function p(_,b){_(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function eu(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(f){return(r=!r)?{value:sr(t[i](f)),done:i==="return"}:s?s(f):f}:s}}function tu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof gn=="function"?gn(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),i(u,h,f.done,f.value)})}}function i(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function ru(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function nu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function iu(t){return t&&t.__esModule?t:{default:t}}function su(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function ou(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var au=Object.freeze({__proto__:null,__extends:Kc,get __assign(){return dn},__rest:Hc,__decorate:Gc,__param:Vc,__metadata:Wc,__awaiter:qc,__generator:Yc,__createBinding:kc,__exportStar:Xc,__values:gn,__read:Ci,__spread:Jc,__spreadArrays:Qc,__await:sr,__asyncGenerator:Zc,__asyncDelegator:eu,__asyncValues:tu,__makeTemplateObject:ru,__importStar:nu,__importDefault:iu,__classPrivateFieldGet:su,__classPrivateFieldSet:ou}),Ar=Lt(au),yn={},or={},Ai;function cu(){if(Ai)return or;Ai=1,Object.defineProperty(or,"__esModule",{value:!0}),or.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return or.delay=t,or}var Ut={},_n={},Mt={},Pi;function uu(){return Pi||(Pi=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.ONE_THOUSAND=Mt.ONE_HUNDRED=void 0,Mt.ONE_HUNDRED=100,Mt.ONE_THOUSAND=1e3),Mt}var pn={},Li;function fu(){return Li||(Li=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(pn)),pn}var Ni;function Ui(){return Ni||(Ni=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ar;e.__exportStar(uu(),t),e.__exportStar(fu(),t)}(_n)),_n}var Mi;function hu(){if(Mi)return Ut;Mi=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.fromMiliseconds=Ut.toMiliseconds=void 0;const t=Ui();function e(n){return n*t.ONE_THOUSAND}Ut.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Ut.fromMiliseconds=r,Ut}var $i;function lu(){return $i||($i=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ar;e.__exportStar(cu(),t),e.__exportStar(hu(),t)}(yn)),yn}var qt={},ji;function du(){if(ji)return qt;ji=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return qt.Watch=t,qt.default=t,qt}var bn={},ar={},Fi;function gu(){if(Fi)return ar;Fi=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.IWatch=void 0;class t{}return ar.IWatch=t,ar}var Bi;function yu(){return Bi||(Bi=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ar.__exportStar(gu(),t)}(bn)),bn}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ar;e.__exportStar(lu(),t),e.__exportStar(du(),t),e.__exportStar(yu(),t),e.__exportStar(Ui(),t)})(ae);var vn={},cr={};class $t{}var _u=Object.freeze({__proto__:null,IEvents:$t}),pu=Lt(_u),zi;function bu(){if(zi)return cr;zi=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.IHeartBeat=void 0;const t=pu;class e extends t.IEvents{constructor(n){super()}}return cr.IHeartBeat=e,cr}var Ki;function Hi(){return Ki||(Ki=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Cr.__exportStar(bu(),t)}(vn)),vn}var wn={},jt={},Gi;function vu(){if(Gi)return jt;Gi=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.HEARTBEAT_EVENTS=jt.HEARTBEAT_INTERVAL=void 0;const t=ae;return jt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,jt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},jt}var Vi;function Wi(){return Vi||(Vi=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Cr.__exportStar(vu(),t)}(wn)),wn}var qi;function wu(){if(qi)return ir;qi=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.HeartBeat=void 0;const t=Cr,e=ht.exports,r=ae,n=Hi(),i=Wi();class s extends n.IHeartBeat{constructor(u){super(u),this.events=new e.EventEmitter,this.interval=i.HEARTBEAT_INTERVAL,this.interval=u?.interval||i.HEARTBEAT_INTERVAL}static init(u){return t.__awaiter(this,void 0,void 0,function*(){const h=new s(u);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(u,h){this.events.on(u,h)}once(u,h){this.events.once(u,h)}off(u,h){this.events.off(u,h)}removeListener(u,h){this.events.removeListener(u,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(i.HEARTBEAT_EVENTS.pulse)}}return ir.HeartBeat=s,ir}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Cr;e.__exportStar(wu(),t),e.__exportStar(Hi(),t),e.__exportStar(Wi(),t)})(Wt);var Ee={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var mn=function(t,e){return mn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},mn(t,e)};function mu(t,e){mn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var En=function(){return En=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},En.apply(this,arguments)};function Eu(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Du(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(i<3?f(s):i>3?f(e,r,s):f(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Su(t,e){return function(r,n){e(r,n,t)}}function Ou(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Iu(t,e,r,n){function i(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(n.next(l))}catch(p){f(p)}}function h(l){try{c(n.throw(l))}catch(p){f(p)}}function c(l){l.done?s(l.value):i(l.value).then(u,h)}c((n=n.apply(t,e||[])).next())})}function Tu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function xu(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Ru(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Dn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yi(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],f;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(u){f={error:u}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function Cu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Yi(arguments[e]));return t}function Au(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,i++)n[i]=s[f];return n}function ur(t){return this instanceof ur?(this.v=t,this):new ur(t)}function Pu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},f("next"),f("throw"),f("return"),i[Symbol.asyncIterator]=function(){return this},i;function f(_){n[_]&&(i[_]=function(b){return new Promise(function(O,A){s.push([_,b,O,A])>1||u(_,b)})})}function u(_,b){try{h(n[_](b))}catch(O){p(s[0][3],O)}}function h(_){_.value instanceof ur?Promise.resolve(_.value.v).then(c,l):p(s[0][2],_)}function c(_){u("next",_)}function l(_){u("throw",_)}function p(_,b){_(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function Lu(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(f){return(r=!r)?{value:ur(t[i](f)),done:i==="return"}:s?s(f):f}:s}}function Nu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Dn=="function"?Dn(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),i(u,h,f.done,f.value)})}}function i(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function Uu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Mu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function $u(t){return t&&t.__esModule?t:{default:t}}function ju(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Fu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Bu=Object.freeze({__proto__:null,__extends:mu,get __assign(){return En},__rest:Eu,__decorate:Du,__param:Su,__metadata:Ou,__awaiter:Iu,__generator:Tu,__createBinding:xu,__exportStar:Ru,__values:Dn,__read:Yi,__spread:Cu,__spreadArrays:Au,__await:ur,__asyncGenerator:Pu,__asyncDelegator:Lu,__asyncValues:Nu,__makeTemplateObject:Uu,__importStar:Mu,__importDefault:$u,__classPrivateFieldGet:ju,__classPrivateFieldSet:Fu}),zu=Lt(Bu),Sn,ki;function Ku(){if(ki)return Sn;ki=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Sn=e;function e(r,n,i){var s=i&&i.stringify||t,f=1;if(typeof r=="object"&&r!==null){var u=n.length+f;if(u===1)return r;var h=new Array(u);h[0]=s(r);for(var c=1;c<u;c++)h[c]=s(n[c]);return h.join(" ")}if(typeof r!="string")return r;var l=n.length;if(l===0)return r;for(var p="",_=1-f,b=-1,O=r&&r.length||0,A=0;A<O;){if(r.charCodeAt(A)===37&&A+1<O){switch(b=b>-1?b:0,r.charCodeAt(A+1)){case 100:case 102:if(_>=l||n[_]==null)break;b<A&&(p+=r.slice(b,A)),p+=Number(n[_]),b=A+2,A++;break;case 105:if(_>=l||n[_]==null)break;b<A&&(p+=r.slice(b,A)),p+=Math.floor(Number(n[_])),b=A+2,A++;break;case 79:case 111:case 106:if(_>=l||n[_]===void 0)break;b<A&&(p+=r.slice(b,A));var N=typeof n[_];if(N==="string"){p+="'"+n[_]+"'",b=A+2,A++;break}if(N==="function"){p+=n[_].name||"<anonymous>",b=A+2,A++;break}p+=s(n[_]),b=A+2,A++;break;case 115:if(_>=l)break;b<A&&(p+=r.slice(b,A)),p+=String(n[_]),b=A+2,A++;break;case 37:b<A&&(p+=r.slice(b,A)),p+="%",b=A+2,A++,_--;break}++_}++A}return b===-1?r:(b<O&&(p+=r.slice(b)),p)}return Sn}var On,Xi;function Hu(){if(Xi)return On;Xi=1;const t=Ku();On=i;const e=m().console||{},r={mapHttpRequest:O,mapHttpResponse:O,wrapRequestSerializer:A,wrapResponseSerializer:A,wrapErrorSerializer:A,req:O,res:O,err:_};function n(g,o){return Array.isArray(g)?g.filter(function(L){return L!=="!stdSerializers.err"}):g===!0?Object.keys(o):!1}function i(g){g=g||{},g.browser=g.browser||{};const o=g.browser.transmit;if(o&&typeof o.send!="function")throw Error("pino: transmit option must have a send function");const d=g.browser.write||e;g.browser.write&&(g.browser.asObject=!0);const L=g.serializers||{},P=n(g.browser.serialize,L);let K=g.browser.serialize;Array.isArray(g.browser.serialize)&&g.browser.serialize.indexOf("!stdSerializers.err")>-1&&(K=!1);const V=["error","fatal","warn","info","debug","trace"];typeof d=="function"&&(d.error=d.fatal=d.warn=d.info=d.debug=d.trace=d),g.enabled===!1&&(g.level="silent");const J=g.level||"info",I=Object.create(d);I.log||(I.log=N),Object.defineProperty(I,"levelVal",{get:q}),Object.defineProperty(I,"level",{get:F,set:M});const C={transmit:o,serialize:P,asObject:g.browser.asObject,levels:V,timestamp:b(g)};I.levels=i.levels,I.level=J,I.setMaxListeners=I.getMaxListeners=I.emit=I.addListener=I.on=I.prependListener=I.once=I.prependOnceListener=I.removeListener=I.removeAllListeners=I.listeners=I.listenerCount=I.eventNames=I.write=I.flush=N,I.serializers=L,I._serialize=P,I._stdErrSerialize=K,I.child=j,o&&(I._logEvent=p());function q(){return this.level==="silent"?1/0:this.levels.values[this.level]}function F(){return this._level}function M(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,s(C,I,"error","log"),s(C,I,"fatal","error"),s(C,I,"warn","error"),s(C,I,"info","log"),s(C,I,"debug","log"),s(C,I,"trace","log")}function j(U,B){if(!U)throw new Error("missing bindings for child Pino");B=B||{},P&&U.serializers&&(B.serializers=U.serializers);const ee=B.serializers;if(P&&ee){var z=Object.assign({},L,ee),Q=g.browser.serialize===!0?Object.keys(z):P;delete U.serializers,h([U],Q,z,this._stdErrSerialize)}function k(Z){this._childLevel=(Z._childLevel|0)+1,this.error=c(Z,U,"error"),this.fatal=c(Z,U,"fatal"),this.warn=c(Z,U,"warn"),this.info=c(Z,U,"info"),this.debug=c(Z,U,"debug"),this.trace=c(Z,U,"trace"),z&&(this.serializers=z,this._serialize=Q),o&&(this._logEvent=p([].concat(Z._logEvent.bindings,U)))}return k.prototype=this,new k(this)}return I}i.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},i.stdSerializers=r,i.stdTimeFunctions=Object.assign({},{nullTime:G,epochTime:E,unixTime:R,isoTime:w});function s(g,o,d,L){const P=Object.getPrototypeOf(o);o[d]=o.levelVal>o.levels.values[d]?N:P[d]?P[d]:e[d]||e[L]||N,f(g,o,d)}function f(g,o,d){!g.transmit&&o[d]===N||(o[d]=function(L){return function(){const K=g.timestamp(),V=new Array(arguments.length),J=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var I=0;I<V.length;I++)V[I]=arguments[I];if(g.serialize&&!g.asObject&&h(V,this._serialize,this.serializers,this._stdErrSerialize),g.asObject?L.call(J,u(this,d,V,K)):L.apply(J,V),g.transmit){const C=g.transmit.level||o.level,q=i.levels.values[C],F=i.levels.values[d];if(F<q)return;l(this,{ts:K,methodLevel:d,methodValue:F,transmitLevel:C,transmitValue:i.levels.values[g.transmit.level||o.level],send:g.transmit.send,val:o.levelVal},V)}}}(o[d]))}function u(g,o,d,L){g._serialize&&h(d,g._serialize,g.serializers,g._stdErrSerialize);const P=d.slice();let K=P[0];const V={};L&&(V.time=L),V.level=i.levels.values[o];let J=(g._childLevel|0)+1;if(J<1&&(J=1),K!==null&&typeof K=="object"){for(;J--&&typeof P[0]=="object";)Object.assign(V,P.shift());K=P.length?t(P.shift(),P):void 0}else typeof K=="string"&&(K=t(P.shift(),P));return K!==void 0&&(V.msg=K),V}function h(g,o,d,L){for(const P in g)if(L&&g[P]instanceof Error)g[P]=i.stdSerializers.err(g[P]);else if(typeof g[P]=="object"&&!Array.isArray(g[P]))for(const K in g[P])o&&o.indexOf(K)>-1&&K in d&&(g[P][K]=d[K](g[P][K]))}function c(g,o,d){return function(){const L=new Array(1+arguments.length);L[0]=o;for(var P=1;P<L.length;P++)L[P]=arguments[P-1];return g[d].apply(this,L)}}function l(g,o,d){const L=o.send,P=o.ts,K=o.methodLevel,V=o.methodValue,J=o.val,I=g._logEvent.bindings;h(d,g._serialize||Object.keys(g.serializers),g.serializers,g._stdErrSerialize===void 0?!0:g._stdErrSerialize),g._logEvent.ts=P,g._logEvent.messages=d.filter(function(C){return I.indexOf(C)===-1}),g._logEvent.level.label=K,g._logEvent.level.value=V,L(K,g._logEvent,J),g._logEvent=p(I)}function p(g){return{ts:0,messages:[],bindings:g||[],level:{label:"",value:0}}}function _(g){const o={type:g.constructor.name,msg:g.message,stack:g.stack};for(const d in g)o[d]===void 0&&(o[d]=g[d]);return o}function b(g){return typeof g.timestamp=="function"?g.timestamp:g.timestamp===!1?G:E}function O(){return{}}function A(g){return g}function N(){}function G(){return!1}function E(){return Date.now()}function R(){return Math.round(Date.now()/1e3)}function w(){return new Date(Date.now()).toISOString()}function m(){function g(o){return typeof o<"u"&&o}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return g(self)||g(window)||g(this)||{}}}return On}var Ft={},Ji;function Qi(){return Ji||(Ji=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.PINO_CUSTOM_CONTEXT_KEY=Ft.PINO_LOGGER_DEFAULTS=void 0,Ft.PINO_LOGGER_DEFAULTS={level:"info"},Ft.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Ft}var tt={},Zi;function Gu(){if(Zi)return tt;Zi=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.generateChildLogger=tt.formatChildLoggerContext=tt.getLoggerContext=tt.setBrowserLoggerContext=tt.getBrowserLoggerContext=tt.getDefaultLoggerOptions=void 0;const t=Qi();function e(u){return Object.assign(Object.assign({},u),{level:u?.level||t.PINO_LOGGER_DEFAULTS.level})}tt.getDefaultLoggerOptions=e;function r(u,h=t.PINO_CUSTOM_CONTEXT_KEY){return u[h]||""}tt.getBrowserLoggerContext=r;function n(u,h,c=t.PINO_CUSTOM_CONTEXT_KEY){return u[c]=h,u}tt.setBrowserLoggerContext=n;function i(u,h=t.PINO_CUSTOM_CONTEXT_KEY){let c="";return typeof u.bindings>"u"?c=r(u,h):c=u.bindings().context||"",c}tt.getLoggerContext=i;function s(u,h,c=t.PINO_CUSTOM_CONTEXT_KEY){const l=i(u,c);return l.trim()?`${l}/${h}`:h}tt.formatChildLoggerContext=s;function f(u,h,c=t.PINO_CUSTOM_CONTEXT_KEY){const l=s(u,h,c),p=u.child({context:l});return n(p,l,c)}return tt.generateChildLogger=f,tt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=zu,r=e.__importDefault(Hu());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(Qi(),t),e.__exportStar(Gu(),t)})(Ee);class Vu extends $t{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class Wu extends $t{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class qu{constructor(e,r){this.logger=e,this.core=r}}class Yu extends $t{constructor(e,r){super(),this.relayer=e,this.logger=r}}class ku extends $t{constructor(e){super()}}class Xu{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}}class Ju extends $t{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Qu extends $t{constructor(e,r){super(),this.core=e,this.logger=r}}class Zu{constructor(e,r){this.projectId=e,this.logger=r}}class ef{constructor(e,r){this.projectId=e,this.logger=r}}var In={},Yt={},Pr={},Lr={};Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.BrowserRandomSource=void 0;const es=65536;class tf{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let n=0;n<r.length;n+=es)this._crypto.getRandomValues(r.subarray(n,n+Math.min(r.length-n,es)));return r}}Lr.BrowserRandomSource=tf;function rf(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Nr={},ct={};Object.defineProperty(ct,"__esModule",{value:!0});function nf(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ct.wipe=nf;var sf={},of=Object.freeze({__proto__:null,default:sf}),af=Lt(of);Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.NodeRandomSource=void 0;const cf=ct;class uf{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof rf<"u"){const e=af;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const n=new Uint8Array(e);for(let i=0;i<n.length;i++)n[i]=r[i];return(0,cf.wipe)(r),n}}Nr.NodeRandomSource=uf,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.SystemRandomSource=void 0;const ff=Lr,hf=Nr;class lf{constructor(){if(this.isAvailable=!1,this.name="",this._source=new ff.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new hf.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Pr.SystemRandomSource=lf;var re={},ts={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(u,h){var c=u>>>16&65535,l=u&65535,p=h>>>16&65535,_=h&65535;return l*_+(c*_+l*p<<16>>>0)|0}t.mul=Math.imul||e;function r(u,h){return u+h|0}t.add=r;function n(u,h){return u-h|0}t.sub=n;function i(u,h){return u<<h|u>>>32-h}t.rotl=i;function s(u,h){return u<<32-h|u>>>h}t.rotr=s;function f(u){return typeof u=="number"&&isFinite(u)&&Math.floor(u)===u}t.isInteger=Number.isInteger||f,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(u){return t.isInteger(u)&&u>=-t.MAX_SAFE_INTEGER&&u<=t.MAX_SAFE_INTEGER}})(ts),Object.defineProperty(re,"__esModule",{value:!0});var rs=ts;function df(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}re.readInt16BE=df;function gf(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}re.readUint16BE=gf;function yf(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}re.readInt16LE=yf;function _f(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}re.readUint16LE=_f;function ns(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}re.writeUint16BE=ns,re.writeInt16BE=ns;function is(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}re.writeUint16LE=is,re.writeInt16LE=is;function Tn(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}re.readInt32BE=Tn;function xn(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}re.readUint32BE=xn;function Rn(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}re.readInt32LE=Rn;function Cn(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}re.readUint32LE=Cn;function Ur(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}re.writeUint32BE=Ur,re.writeInt32BE=Ur;function Mr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}re.writeUint32LE=Mr,re.writeInt32LE=Mr;function pf(t,e){e===void 0&&(e=0);var r=Tn(t,e),n=Tn(t,e+4);return r*4294967296+n-(n>>31)*4294967296}re.readInt64BE=pf;function bf(t,e){e===void 0&&(e=0);var r=xn(t,e),n=xn(t,e+4);return r*4294967296+n}re.readUint64BE=bf;function vf(t,e){e===void 0&&(e=0);var r=Rn(t,e),n=Rn(t,e+4);return n*4294967296+r-(r>>31)*4294967296}re.readInt64LE=vf;function wf(t,e){e===void 0&&(e=0);var r=Cn(t,e),n=Cn(t,e+4);return n*4294967296+r}re.readUint64LE=wf;function ss(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Ur(t/4294967296>>>0,e,r),Ur(t>>>0,e,r+4),e}re.writeUint64BE=ss,re.writeInt64BE=ss;function os(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Mr(t>>>0,e,r),Mr(t/4294967296>>>0,e,r+4),e}re.writeUint64LE=os,re.writeInt64LE=os;function mf(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=t/8+r-1;s>=r;s--)n+=e[s]*i,i*=256;return n}re.readUintBE=mf;function Ef(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=r;s<r+t/8;s++)n+=e[s]*i,i*=256;return n}re.readUintLE=Ef;function Df(t,e,r,n){if(r===void 0&&(r=new Uint8Array(t/8)),n===void 0&&(n=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!rs.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var i=1,s=t/8+n-1;s>=n;s--)r[s]=e/i&255,i*=256;return r}re.writeUintBE=Df;function Sf(t,e,r,n){if(r===void 0&&(r=new Uint8Array(t/8)),n===void 0&&(n=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!rs.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var i=1,s=n;s<n+t/8;s++)r[s]=e/i&255,i*=256;return r}re.writeUintLE=Sf;function Of(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}re.readFloat32BE=Of;function If(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}re.readFloat32LE=If;function Tf(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}re.readFloat64BE=Tf;function xf(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}re.readFloat64LE=xf;function Rf(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(r,t),e}re.writeFloat32BE=Rf;function Cf(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(r,t,!0),e}re.writeFloat32LE=Cf;function Af(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(r,t),e}re.writeFloat64BE=Af;function Pf(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(r,t,!0),e}re.writeFloat64LE=Pf,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Pr,r=re,n=ct;t.defaultRandomSource=new e.SystemRandomSource;function i(c,l=t.defaultRandomSource){return l.randomBytes(c)}t.randomBytes=i;function s(c=t.defaultRandomSource){const l=i(4,c),p=(0,r.readUint32LE)(l);return(0,n.wipe)(l),p}t.randomUint32=s;const f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function u(c,l=f,p=t.defaultRandomSource){if(l.length<2)throw new Error("randomString charset is too short");if(l.length>256)throw new Error("randomString charset is too long");let _="";const b=l.length,O=256-256%b;for(;c>0;){const A=i(Math.ceil(c*256/O),p);for(let N=0;N<A.length&&c>0;N++){const G=A[N];G<O&&(_+=l.charAt(G%b),c--)}(0,n.wipe)(A)}return _}t.randomString=u;function h(c,l=f,p=t.defaultRandomSource){const _=Math.ceil(c/(Math.log(l.length)/Math.LN2));return u(_,l,p)}t.randomStringForEntropy=h}(Yt);var as={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ct;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var n=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},u.prototype.update=function(h,c){if(c===void 0&&(c=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var l=0;if(this._bytesHashed+=c,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&c>0;)this._buffer[this._bufferLength++]=h[l++],c--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(c>=this.blockSize&&(l=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,l,c),c%=this.blockSize);c>0;)this._buffer[this._bufferLength++]=h[l++],c--;return this},u.prototype.finish=function(h){if(!this._finished){var c=this._bytesHashed,l=this._bufferLength,p=c/536870912|0,_=c<<3,b=c%128<112?128:256;this._buffer[l]=128;for(var O=l+1;O<b-8;O++)this._buffer[O]=0;e.writeUint32BE(p,this._buffer,b-8),e.writeUint32BE(_,this._buffer,b-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,b),this._finished=!0}for(var O=0;O<this.digestLength/8;O++)e.writeUint32BE(this._stateHi[O],h,O*8),e.writeUint32BE(this._stateLo[O],h,O*8+4);return this},u.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},u}();t.SHA512=n;var i=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(u,h,c,l,p,_,b){for(var O=c[0],A=c[1],N=c[2],G=c[3],E=c[4],R=c[5],w=c[6],m=c[7],g=l[0],o=l[1],d=l[2],L=l[3],P=l[4],K=l[5],V=l[6],J=l[7],I,C,q,F,M,j,U,B;b>=128;){for(var ee=0;ee<16;ee++){var z=8*ee+_;u[ee]=e.readUint32BE(p,z),h[ee]=e.readUint32BE(p,z+4)}for(var ee=0;ee<80;ee++){var Q=O,k=A,Z=N,x=G,T=E,D=R,a=w,v=m,H=g,Y=o,he=d,pe=L,de=P,we=K,Ue=V,Ae=J;if(I=m,C=J,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=(E>>>14|P<<32-14)^(E>>>18|P<<32-18)^(P>>>41-32|E<<32-(41-32)),C=(P>>>14|E<<32-14)^(P>>>18|E<<32-18)^(E>>>41-32|P<<32-(41-32)),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=E&R^~E&w,C=P&K^~P&V,M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=i[ee*2],C=i[ee*2+1],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=u[ee%16],C=h[ee%16],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,q=U&65535|B<<16,F=M&65535|j<<16,I=q,C=F,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=(O>>>28|g<<32-28)^(g>>>34-32|O<<32-(34-32))^(g>>>39-32|O<<32-(39-32)),C=(g>>>28|O<<32-28)^(O>>>34-32|g<<32-(34-32))^(O>>>39-32|g<<32-(39-32)),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=O&A^O&N^A&N,C=g&o^g&d^o&d,M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,v=U&65535|B<<16,Ae=M&65535|j<<16,I=x,C=pe,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=q,C=F,M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,x=U&65535|B<<16,pe=M&65535|j<<16,A=Q,N=k,G=Z,E=x,R=T,w=D,m=a,O=v,o=H,d=Y,L=he,P=pe,K=de,V=we,J=Ue,g=Ae,ee%16===15)for(var z=0;z<16;z++)I=u[z],C=h[z],M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=u[(z+9)%16],C=h[(z+9)%16],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,q=u[(z+1)%16],F=h[(z+1)%16],I=(q>>>1|F<<32-1)^(q>>>8|F<<32-8)^q>>>7,C=(F>>>1|q<<32-1)^(F>>>8|q<<32-8)^(F>>>7|q<<32-7),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,q=u[(z+14)%16],F=h[(z+14)%16],I=(q>>>19|F<<32-19)^(F>>>61-32|q<<32-(61-32))^q>>>6,C=(F>>>19|q<<32-19)^(q>>>61-32|F<<32-(61-32))^(F>>>6|q<<32-6),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,u[z]=U&65535|B<<16,h[z]=M&65535|j<<16}I=O,C=g,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[0],C=l[0],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[0]=O=U&65535|B<<16,l[0]=g=M&65535|j<<16,I=A,C=o,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[1],C=l[1],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[1]=A=U&65535|B<<16,l[1]=o=M&65535|j<<16,I=N,C=d,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[2],C=l[2],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[2]=N=U&65535|B<<16,l[2]=d=M&65535|j<<16,I=G,C=L,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[3],C=l[3],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[3]=G=U&65535|B<<16,l[3]=L=M&65535|j<<16,I=E,C=P,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[4],C=l[4],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[4]=E=U&65535|B<<16,l[4]=P=M&65535|j<<16,I=R,C=K,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[5],C=l[5],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[5]=R=U&65535|B<<16,l[5]=K=M&65535|j<<16,I=w,C=V,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[6],C=l[6],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[6]=w=U&65535|B<<16,l[6]=V=M&65535|j<<16,I=m,C=J,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[7],C=l[7],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[7]=m=U&65535|B<<16,l[7]=J=M&65535|j<<16,_+=128,b-=128}return _}function f(u){var h=new n;h.update(u);var c=h.digest();return h.clean(),c}t.hash=f})(as),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=Yt,r=as,n=ct;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function i(x){const T=new Float64Array(16);if(x)for(let D=0;D<x.length;D++)T[D]=x[D];return T}const s=new Uint8Array(32);s[0]=9;const f=i(),u=i([1]),h=i([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),c=i([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),l=i([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),p=i([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),_=i([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function b(x,T){for(let D=0;D<16;D++)x[D]=T[D]|0}function O(x){let T=1;for(let D=0;D<16;D++){let a=x[D]+T+65535;T=Math.floor(a/65536),x[D]=a-T*65536}x[0]+=T-1+37*(T-1)}function A(x,T,D){const a=~(D-1);for(let v=0;v<16;v++){const H=a&(x[v]^T[v]);x[v]^=H,T[v]^=H}}function N(x,T){const D=i(),a=i();for(let v=0;v<16;v++)a[v]=T[v];O(a),O(a),O(a);for(let v=0;v<2;v++){D[0]=a[0]-65517;for(let Y=1;Y<15;Y++)D[Y]=a[Y]-65535-(D[Y-1]>>16&1),D[Y-1]&=65535;D[15]=a[15]-32767-(D[14]>>16&1);const H=D[15]>>16&1;D[14]&=65535,A(a,D,1-H)}for(let v=0;v<16;v++)x[2*v]=a[v]&255,x[2*v+1]=a[v]>>8}function G(x,T){let D=0;for(let a=0;a<32;a++)D|=x[a]^T[a];return(1&D-1>>>8)-1}function E(x,T){const D=new Uint8Array(32),a=new Uint8Array(32);return N(D,x),N(a,T),G(D,a)}function R(x){const T=new Uint8Array(32);return N(T,x),T[0]&1}function w(x,T){for(let D=0;D<16;D++)x[D]=T[2*D]+(T[2*D+1]<<8);x[15]&=32767}function m(x,T,D){for(let a=0;a<16;a++)x[a]=T[a]+D[a]}function g(x,T,D){for(let a=0;a<16;a++)x[a]=T[a]-D[a]}function o(x,T,D){let a,v,H=0,Y=0,he=0,pe=0,de=0,we=0,Ue=0,Ae=0,_e=0,ge=0,le=0,ue=0,ce=0,oe=0,se=0,te=0,fe=0,ye=0,ne=0,be=0,ve=0,De=0,Se=0,me=0,bt=0,Et=0,Rt=0,ut=0,zt=0,wr=0,Qr=0,Me=D[0],Pe=D[1],$e=D[2],je=D[3],Fe=D[4],Le=D[5],He=D[6],Ge=D[7],Ve=D[8],We=D[9],qe=D[10],ze=D[11],Be=D[12],Re=D[13],Ye=D[14],ke=D[15];a=T[0],H+=a*Me,Y+=a*Pe,he+=a*$e,pe+=a*je,de+=a*Fe,we+=a*Le,Ue+=a*He,Ae+=a*Ge,_e+=a*Ve,ge+=a*We,le+=a*qe,ue+=a*ze,ce+=a*Be,oe+=a*Re,se+=a*Ye,te+=a*ke,a=T[1],Y+=a*Me,he+=a*Pe,pe+=a*$e,de+=a*je,we+=a*Fe,Ue+=a*Le,Ae+=a*He,_e+=a*Ge,ge+=a*Ve,le+=a*We,ue+=a*qe,ce+=a*ze,oe+=a*Be,se+=a*Re,te+=a*Ye,fe+=a*ke,a=T[2],he+=a*Me,pe+=a*Pe,de+=a*$e,we+=a*je,Ue+=a*Fe,Ae+=a*Le,_e+=a*He,ge+=a*Ge,le+=a*Ve,ue+=a*We,ce+=a*qe,oe+=a*ze,se+=a*Be,te+=a*Re,fe+=a*Ye,ye+=a*ke,a=T[3],pe+=a*Me,de+=a*Pe,we+=a*$e,Ue+=a*je,Ae+=a*Fe,_e+=a*Le,ge+=a*He,le+=a*Ge,ue+=a*Ve,ce+=a*We,oe+=a*qe,se+=a*ze,te+=a*Be,fe+=a*Re,ye+=a*Ye,ne+=a*ke,a=T[4],de+=a*Me,we+=a*Pe,Ue+=a*$e,Ae+=a*je,_e+=a*Fe,ge+=a*Le,le+=a*He,ue+=a*Ge,ce+=a*Ve,oe+=a*We,se+=a*qe,te+=a*ze,fe+=a*Be,ye+=a*Re,ne+=a*Ye,be+=a*ke,a=T[5],we+=a*Me,Ue+=a*Pe,Ae+=a*$e,_e+=a*je,ge+=a*Fe,le+=a*Le,ue+=a*He,ce+=a*Ge,oe+=a*Ve,se+=a*We,te+=a*qe,fe+=a*ze,ye+=a*Be,ne+=a*Re,be+=a*Ye,ve+=a*ke,a=T[6],Ue+=a*Me,Ae+=a*Pe,_e+=a*$e,ge+=a*je,le+=a*Fe,ue+=a*Le,ce+=a*He,oe+=a*Ge,se+=a*Ve,te+=a*We,fe+=a*qe,ye+=a*ze,ne+=a*Be,be+=a*Re,ve+=a*Ye,De+=a*ke,a=T[7],Ae+=a*Me,_e+=a*Pe,ge+=a*$e,le+=a*je,ue+=a*Fe,ce+=a*Le,oe+=a*He,se+=a*Ge,te+=a*Ve,fe+=a*We,ye+=a*qe,ne+=a*ze,be+=a*Be,ve+=a*Re,De+=a*Ye,Se+=a*ke,a=T[8],_e+=a*Me,ge+=a*Pe,le+=a*$e,ue+=a*je,ce+=a*Fe,oe+=a*Le,se+=a*He,te+=a*Ge,fe+=a*Ve,ye+=a*We,ne+=a*qe,be+=a*ze,ve+=a*Be,De+=a*Re,Se+=a*Ye,me+=a*ke,a=T[9],ge+=a*Me,le+=a*Pe,ue+=a*$e,ce+=a*je,oe+=a*Fe,se+=a*Le,te+=a*He,fe+=a*Ge,ye+=a*Ve,ne+=a*We,be+=a*qe,ve+=a*ze,De+=a*Be,Se+=a*Re,me+=a*Ye,bt+=a*ke,a=T[10],le+=a*Me,ue+=a*Pe,ce+=a*$e,oe+=a*je,se+=a*Fe,te+=a*Le,fe+=a*He,ye+=a*Ge,ne+=a*Ve,be+=a*We,ve+=a*qe,De+=a*ze,Se+=a*Be,me+=a*Re,bt+=a*Ye,Et+=a*ke,a=T[11],ue+=a*Me,ce+=a*Pe,oe+=a*$e,se+=a*je,te+=a*Fe,fe+=a*Le,ye+=a*He,ne+=a*Ge,be+=a*Ve,ve+=a*We,De+=a*qe,Se+=a*ze,me+=a*Be,bt+=a*Re,Et+=a*Ye,Rt+=a*ke,a=T[12],ce+=a*Me,oe+=a*Pe,se+=a*$e,te+=a*je,fe+=a*Fe,ye+=a*Le,ne+=a*He,be+=a*Ge,ve+=a*Ve,De+=a*We,Se+=a*qe,me+=a*ze,bt+=a*Be,Et+=a*Re,Rt+=a*Ye,ut+=a*ke,a=T[13],oe+=a*Me,se+=a*Pe,te+=a*$e,fe+=a*je,ye+=a*Fe,ne+=a*Le,be+=a*He,ve+=a*Ge,De+=a*Ve,Se+=a*We,me+=a*qe,bt+=a*ze,Et+=a*Be,Rt+=a*Re,ut+=a*Ye,zt+=a*ke,a=T[14],se+=a*Me,te+=a*Pe,fe+=a*$e,ye+=a*je,ne+=a*Fe,be+=a*Le,ve+=a*He,De+=a*Ge,Se+=a*Ve,me+=a*We,bt+=a*qe,Et+=a*ze,Rt+=a*Be,ut+=a*Re,zt+=a*Ye,wr+=a*ke,a=T[15],te+=a*Me,fe+=a*Pe,ye+=a*$e,ne+=a*je,be+=a*Fe,ve+=a*Le,De+=a*He,Se+=a*Ge,me+=a*Ve,bt+=a*We,Et+=a*qe,Rt+=a*ze,ut+=a*Be,zt+=a*Re,wr+=a*Ye,Qr+=a*ke,H+=38*fe,Y+=38*ye,he+=38*ne,pe+=38*be,de+=38*ve,we+=38*De,Ue+=38*Se,Ae+=38*me,_e+=38*bt,ge+=38*Et,le+=38*Rt,ue+=38*ut,ce+=38*zt,oe+=38*wr,se+=38*Qr,v=1,a=H+v+65535,v=Math.floor(a/65536),H=a-v*65536,a=Y+v+65535,v=Math.floor(a/65536),Y=a-v*65536,a=he+v+65535,v=Math.floor(a/65536),he=a-v*65536,a=pe+v+65535,v=Math.floor(a/65536),pe=a-v*65536,a=de+v+65535,v=Math.floor(a/65536),de=a-v*65536,a=we+v+65535,v=Math.floor(a/65536),we=a-v*65536,a=Ue+v+65535,v=Math.floor(a/65536),Ue=a-v*65536,a=Ae+v+65535,v=Math.floor(a/65536),Ae=a-v*65536,a=_e+v+65535,v=Math.floor(a/65536),_e=a-v*65536,a=ge+v+65535,v=Math.floor(a/65536),ge=a-v*65536,a=le+v+65535,v=Math.floor(a/65536),le=a-v*65536,a=ue+v+65535,v=Math.floor(a/65536),ue=a-v*65536,a=ce+v+65535,v=Math.floor(a/65536),ce=a-v*65536,a=oe+v+65535,v=Math.floor(a/65536),oe=a-v*65536,a=se+v+65535,v=Math.floor(a/65536),se=a-v*65536,a=te+v+65535,v=Math.floor(a/65536),te=a-v*65536,H+=v-1+37*(v-1),v=1,a=H+v+65535,v=Math.floor(a/65536),H=a-v*65536,a=Y+v+65535,v=Math.floor(a/65536),Y=a-v*65536,a=he+v+65535,v=Math.floor(a/65536),he=a-v*65536,a=pe+v+65535,v=Math.floor(a/65536),pe=a-v*65536,a=de+v+65535,v=Math.floor(a/65536),de=a-v*65536,a=we+v+65535,v=Math.floor(a/65536),we=a-v*65536,a=Ue+v+65535,v=Math.floor(a/65536),Ue=a-v*65536,a=Ae+v+65535,v=Math.floor(a/65536),Ae=a-v*65536,a=_e+v+65535,v=Math.floor(a/65536),_e=a-v*65536,a=ge+v+65535,v=Math.floor(a/65536),ge=a-v*65536,a=le+v+65535,v=Math.floor(a/65536),le=a-v*65536,a=ue+v+65535,v=Math.floor(a/65536),ue=a-v*65536,a=ce+v+65535,v=Math.floor(a/65536),ce=a-v*65536,a=oe+v+65535,v=Math.floor(a/65536),oe=a-v*65536,a=se+v+65535,v=Math.floor(a/65536),se=a-v*65536,a=te+v+65535,v=Math.floor(a/65536),te=a-v*65536,H+=v-1+37*(v-1),x[0]=H,x[1]=Y,x[2]=he,x[3]=pe,x[4]=de,x[5]=we,x[6]=Ue,x[7]=Ae,x[8]=_e,x[9]=ge,x[10]=le,x[11]=ue,x[12]=ce,x[13]=oe,x[14]=se,x[15]=te}function d(x,T){o(x,T,T)}function L(x,T){const D=i();let a;for(a=0;a<16;a++)D[a]=T[a];for(a=253;a>=0;a--)d(D,D),a!==2&&a!==4&&o(D,D,T);for(a=0;a<16;a++)x[a]=D[a]}function P(x,T){const D=i();let a;for(a=0;a<16;a++)D[a]=T[a];for(a=250;a>=0;a--)d(D,D),a!==1&&o(D,D,T);for(a=0;a<16;a++)x[a]=D[a]}function K(x,T){const D=i(),a=i(),v=i(),H=i(),Y=i(),he=i(),pe=i(),de=i(),we=i();g(D,x[1],x[0]),g(we,T[1],T[0]),o(D,D,we),m(a,x[0],x[1]),m(we,T[0],T[1]),o(a,a,we),o(v,x[3],T[3]),o(v,v,c),o(H,x[2],T[2]),m(H,H,H),g(Y,a,D),g(he,H,v),m(pe,H,v),m(de,a,D),o(x[0],Y,he),o(x[1],de,pe),o(x[2],pe,he),o(x[3],Y,de)}function V(x,T,D){for(let a=0;a<4;a++)A(x[a],T[a],D)}function J(x,T){const D=i(),a=i(),v=i();L(v,T[2]),o(D,T[0],v),o(a,T[1],v),N(x,a),x[31]^=R(D)<<7}function I(x,T,D){b(x[0],f),b(x[1],u),b(x[2],u),b(x[3],f);for(let a=255;a>=0;--a){const v=D[a/8|0]>>(a&7)&1;V(x,T,v),K(T,x),K(x,x),V(x,T,v)}}function C(x,T){const D=[i(),i(),i(),i()];b(D[0],l),b(D[1],p),b(D[2],u),o(D[3],l,p),I(x,D,T)}function q(x){if(x.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const T=(0,r.hash)(x);T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(32),a=[i(),i(),i(),i()];C(a,T),J(D,a);const v=new Uint8Array(64);return v.set(x),v.set(D,32),{publicKey:D,secretKey:v}}t.generateKeyPairFromSeed=q;function F(x){const T=(0,e.randomBytes)(32,x),D=q(T);return(0,n.wipe)(T),D}t.generateKeyPair=F;function M(x){if(x.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(x.subarray(32))}t.extractPublicKeyFromSecretKey=M;const j=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function U(x,T){let D,a,v,H;for(a=63;a>=32;--a){for(D=0,v=a-32,H=a-12;v<H;++v)T[v]+=D-16*T[a]*j[v-(a-32)],D=Math.floor((T[v]+128)/256),T[v]-=D*256;T[v]+=D,T[a]=0}for(D=0,v=0;v<32;v++)T[v]+=D-(T[31]>>4)*j[v],D=T[v]>>8,T[v]&=255;for(v=0;v<32;v++)T[v]-=D*j[v];for(a=0;a<32;a++)T[a+1]+=T[a]>>8,x[a]=T[a]&255}function B(x){const T=new Float64Array(64);for(let D=0;D<64;D++)T[D]=x[D];for(let D=0;D<64;D++)x[D]=0;U(x,T)}function ee(x,T){const D=new Float64Array(64),a=[i(),i(),i(),i()],v=(0,r.hash)(x.subarray(0,32));v[0]&=248,v[31]&=127,v[31]|=64;const H=new Uint8Array(64);H.set(v.subarray(32),32);const Y=new r.SHA512;Y.update(H.subarray(32)),Y.update(T);const he=Y.digest();Y.clean(),B(he),C(a,he),J(H,a),Y.reset(),Y.update(H.subarray(0,32)),Y.update(x.subarray(32)),Y.update(T);const pe=Y.digest();B(pe);for(let de=0;de<32;de++)D[de]=he[de];for(let de=0;de<32;de++)for(let we=0;we<32;we++)D[de+we]+=pe[de]*v[we];return U(H.subarray(32),D),H}t.sign=ee;function z(x,T){const D=i(),a=i(),v=i(),H=i(),Y=i(),he=i(),pe=i();return b(x[2],u),w(x[1],T),d(v,x[1]),o(H,v,h),g(v,v,x[2]),m(H,x[2],H),d(Y,H),d(he,Y),o(pe,he,Y),o(D,pe,v),o(D,D,H),P(D,D),o(D,D,v),o(D,D,H),o(D,D,H),o(x[0],D,H),d(a,x[0]),o(a,a,H),E(a,v)&&o(x[0],x[0],_),d(a,x[0]),o(a,a,H),E(a,v)?-1:(R(x[0])===T[31]>>7&&g(x[0],f,x[0]),o(x[3],x[0],x[1]),0)}function Q(x,T,D){const a=new Uint8Array(32),v=[i(),i(),i(),i()],H=[i(),i(),i(),i()];if(D.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(z(H,x))return!1;const Y=new r.SHA512;Y.update(D.subarray(0,32)),Y.update(x),Y.update(T);const he=Y.digest();return B(he),I(v,H,he),C(H,D.subarray(32)),K(v,H),J(a,v),!G(D,a)}t.verify=Q;function k(x){let T=[i(),i(),i(),i()];if(z(T,x))throw new Error("Ed25519: invalid public key");let D=i(),a=i(),v=T[1];m(D,u,v),g(a,u,v),L(a,a),o(D,D,a);let H=new Uint8Array(32);return N(H,D),H}t.convertPublicKeyToX25519=k;function Z(x){const T=(0,r.hash)(x.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(T.subarray(0,32));return(0,n.wipe)(T),D}t.convertSecretKeyToX25519=Z}(In);const Lf="EdDSA",Nf="JWT",cs=".",us="base64url",Uf="utf8",Mf="utf8",$f=":",jf="did",Ff="key",fs="base58btc",Bf="z",zf="K36",Kf=32;function An(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function hs(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?An(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Pn(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=hs(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return An(r)}function Hf(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),f=s.charCodeAt(0);if(r[f]!==255)throw new TypeError(s+" is ambiguous");r[f]=i}var u=t.length,h=t.charAt(0),c=Math.log(u)/Math.log(256),l=Math.log(256)/Math.log(u);function p(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(O.length===0)return"";for(var A=0,N=0,G=0,E=O.length;G!==E&&O[G]===0;)G++,A++;for(var R=(E-G)*l+1>>>0,w=new Uint8Array(R);G!==E;){for(var m=O[G],g=0,o=R-1;(m!==0||g<N)&&o!==-1;o--,g++)m+=256*w[o]>>>0,w[o]=m%u>>>0,m=m/u>>>0;if(m!==0)throw new Error("Non-zero carry");N=g,G++}for(var d=R-N;d!==R&&w[d]===0;)d++;for(var L=h.repeat(A);d<R;++d)L+=t.charAt(w[d]);return L}function _(O){if(typeof O!="string")throw new TypeError("Expected String");if(O.length===0)return new Uint8Array;var A=0;if(O[A]!==" "){for(var N=0,G=0;O[A]===h;)N++,A++;for(var E=(O.length-A)*c+1>>>0,R=new Uint8Array(E);O[A];){var w=r[O.charCodeAt(A)];if(w===255)return;for(var m=0,g=E-1;(w!==0||m<G)&&g!==-1;g--,m++)w+=u*R[g]>>>0,R[g]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");G=m,A++}if(O[A]!==" "){for(var o=E-G;o!==E&&R[o]===0;)o++;for(var d=new Uint8Array(N+(E-o)),L=N;o!==E;)d[L++]=R[o++];return d}}}function b(O){var A=_(O);if(A)return A;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:_,decode:b}}var Gf=Hf,Vf=Gf;const ls=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Wf=t=>new TextEncoder().encode(t),qf=t=>new TextDecoder().decode(t);class Yf{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class kf{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ds(this,e)}}class Xf{constructor(e){this.decoders=e}or(e){return ds(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ds=(t,e)=>new Xf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Jf{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Yf(e,r,n),this.decoder=new kf(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const $r=({name:t,prefix:e,encode:r,decode:n})=>new Jf(t,e,r,n),fr=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=Vf(r,e);return $r({prefix:t,name:e,encode:n,decode:s=>ls(i(s))})},Qf=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const f=new Uint8Array(s*r/8|0);let u=0,h=0,c=0;for(let l=0;l<s;++l){const p=i[t[l]];if(p===void 0)throw new SyntaxError(`Non-${n} character`);h=h<<r|p,u+=r,u>=8&&(u-=8,f[c++]=255&h>>u)}if(u>=r||255&h<<8-u)throw new SyntaxError("Unexpected end of data");return f},Zf=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",f=0,u=0;for(let h=0;h<t.length;++h)for(u=u<<8|t[h],f+=8;f>r;)f-=r,s+=e[i&u>>f];if(f&&(s+=e[i&u<<r-f]),n)for(;s.length*r&7;)s+="=";return s},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>$r({prefix:e,name:t,encode(i){return Zf(i,n,r)},decode(i){return Qf(i,n,r,t)}}),eh=$r({prefix:"\0",name:"identity",encode:t=>qf(t),decode:t=>Wf(t)});var th=Object.freeze({__proto__:null,identity:eh});const rh=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var nh=Object.freeze({__proto__:null,base2:rh});const ih=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var sh=Object.freeze({__proto__:null,base8:ih});const oh=fr({prefix:"9",name:"base10",alphabet:"0123456789"});var ah=Object.freeze({__proto__:null,base10:oh});const ch=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uh=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fh=Object.freeze({__proto__:null,base16:ch,base16upper:uh});const hh=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lh=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dh=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gh=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yh=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_h=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ph=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bh=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vh=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var wh=Object.freeze({__proto__:null,base32:hh,base32upper:lh,base32pad:dh,base32padupper:gh,base32hex:yh,base32hexupper:_h,base32hexpad:ph,base32hexpadupper:bh,base32z:vh});const mh=fr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Eh=fr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Dh=Object.freeze({__proto__:null,base36:mh,base36upper:Eh});const Sh=fr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Oh=fr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ih=Object.freeze({__proto__:null,base58btc:Sh,base58flickr:Oh});const Th=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xh=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Rh=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ch=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ah=Object.freeze({__proto__:null,base64:Th,base64pad:xh,base64url:Rh,base64urlpad:Ch});const gs=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ph=gs.reduce((t,e,r)=>(t[r]=e,t),[]),Lh=gs.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Nh(t){return t.reduce((e,r)=>(e+=Ph[r],e),"")}function Uh(t){const e=[];for(const r of t){const n=Lh[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Mh=$r({prefix:"\u{1F680}",name:"base256emoji",encode:Nh,decode:Uh});var $h=Object.freeze({__proto__:null,base256emoji:Mh}),jh=_s,ys=128,Fh=127,Bh=~Fh,zh=Math.pow(2,31);function _s(t,e,r){e=e||[],r=r||0;for(var n=r;t>=zh;)e[r++]=t&255|ys,t/=128;for(;t&Bh;)e[r++]=t&255|ys,t>>>=7;return e[r]=t|0,_s.bytes=r-n+1,e}var Kh=Ln,Hh=128,ps=127;function Ln(t,n){var r=0,n=n||0,i=0,s=n,f,u=t.length;do{if(s>=u)throw Ln.bytes=0,new RangeError("Could not decode varint");f=t[s++],r+=i<28?(f&ps)<<i:(f&ps)*Math.pow(2,i),i+=7}while(f>=Hh);return Ln.bytes=s-n,r}var Gh=Math.pow(2,7),Vh=Math.pow(2,14),Wh=Math.pow(2,21),qh=Math.pow(2,28),Yh=Math.pow(2,35),kh=Math.pow(2,42),Xh=Math.pow(2,49),Jh=Math.pow(2,56),Qh=Math.pow(2,63),Zh=function(t){return t<Gh?1:t<Vh?2:t<Wh?3:t<qh?4:t<Yh?5:t<kh?6:t<Xh?7:t<Jh?8:t<Qh?9:10},el={encode:jh,decode:Kh,encodingLength:Zh},bs=el;const vs=(t,e,r=0)=>(bs.encode(t,e,r),e),ws=t=>bs.encodingLength(t),Nn=(t,e)=>{const r=e.byteLength,n=ws(t),i=n+ws(r),s=new Uint8Array(i+r);return vs(t,s,0),vs(r,s,n),s.set(e,i),new tl(t,r,e,s)};class tl{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const ms=({name:t,code:e,encode:r})=>new rl(t,e,r);class rl{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Nn(this.code,r):r.then(n=>Nn(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Es=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),nl=ms({name:"sha2-256",code:18,encode:Es("SHA-256")}),il=ms({name:"sha2-512",code:19,encode:Es("SHA-512")});var sl=Object.freeze({__proto__:null,sha256:nl,sha512:il});const Ds=0,ol="identity",Ss=ls;var al=Object.freeze({__proto__:null,identity:{code:Ds,name:ol,encode:Ss,digest:t=>Nn(Ds,Ss(t))}});new TextEncoder,new TextDecoder;const Os={...th,...nh,...sh,...ah,...fh,...wh,...Dh,...Ih,...Ah,...$h};({...sl,...al});function Is(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Ts=Is("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Un=Is("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=hs(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),xs={utf8:Ts,"utf-8":Ts,hex:Os.base16,latin1:Un,ascii:Un,binary:Un,...Os};function rt(t,e="utf8"){const r=xs[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function nt(t,e="utf8"){const r=xs[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?An(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function jr(t){return rt(nt(rr(t),Uf),us)}function Rs(t){const e=nt(zf,fs),r=Bf+rt(Pn([e,t]),fs);return[jf,Ff,r].join($f)}function cl(t){return rt(t,us)}function ul(t){return nt([jr(t.header),jr(t.payload)].join(cs),Mf)}function fl(t){return[jr(t.header),jr(t.payload),cl(t.signature)].join(cs)}function Cs(t=Yt.randomBytes(Kf)){return In.generateKeyPairFromSeed(t)}async function hl(t,e,r,n,i=ae.fromMiliseconds(Date.now())){const s={alg:Lf,typ:Nf},f=Rs(n.publicKey),u=i+r,h={iss:f,sub:t,aud:e,iat:i,exp:u},c=ul({header:s,payload:h}),l=In.sign(n.secretKey,c);return fl({header:s,payload:h,signature:l})}var Mn={},Fr={};Object.defineProperty(Fr,"__esModule",{value:!0});var Ze=re,$n=ct,ll=20;function dl(t,e,r){for(var n=1634760805,i=857760878,s=2036477234,f=1797285236,u=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],c=r[11]<<24|r[10]<<16|r[9]<<8|r[8],l=r[15]<<24|r[14]<<16|r[13]<<8|r[12],p=r[19]<<24|r[18]<<16|r[17]<<8|r[16],_=r[23]<<24|r[22]<<16|r[21]<<8|r[20],b=r[27]<<24|r[26]<<16|r[25]<<8|r[24],O=r[31]<<24|r[30]<<16|r[29]<<8|r[28],A=e[3]<<24|e[2]<<16|e[1]<<8|e[0],N=e[7]<<24|e[6]<<16|e[5]<<8|e[4],G=e[11]<<24|e[10]<<16|e[9]<<8|e[8],E=e[15]<<24|e[14]<<16|e[13]<<8|e[12],R=n,w=i,m=s,g=f,o=u,d=h,L=c,P=l,K=p,V=_,J=b,I=O,C=A,q=N,F=G,M=E,j=0;j<ll;j+=2)R=R+o|0,C^=R,C=C>>>32-16|C<<16,K=K+C|0,o^=K,o=o>>>32-12|o<<12,w=w+d|0,q^=w,q=q>>>32-16|q<<16,V=V+q|0,d^=V,d=d>>>32-12|d<<12,m=m+L|0,F^=m,F=F>>>32-16|F<<16,J=J+F|0,L^=J,L=L>>>32-12|L<<12,g=g+P|0,M^=g,M=M>>>32-16|M<<16,I=I+M|0,P^=I,P=P>>>32-12|P<<12,m=m+L|0,F^=m,F=F>>>32-8|F<<8,J=J+F|0,L^=J,L=L>>>32-7|L<<7,g=g+P|0,M^=g,M=M>>>32-8|M<<8,I=I+M|0,P^=I,P=P>>>32-7|P<<7,w=w+d|0,q^=w,q=q>>>32-8|q<<8,V=V+q|0,d^=V,d=d>>>32-7|d<<7,R=R+o|0,C^=R,C=C>>>32-8|C<<8,K=K+C|0,o^=K,o=o>>>32-7|o<<7,R=R+d|0,M^=R,M=M>>>32-16|M<<16,J=J+M|0,d^=J,d=d>>>32-12|d<<12,w=w+L|0,C^=w,C=C>>>32-16|C<<16,I=I+C|0,L^=I,L=L>>>32-12|L<<12,m=m+P|0,q^=m,q=q>>>32-16|q<<16,K=K+q|0,P^=K,P=P>>>32-12|P<<12,g=g+o|0,F^=g,F=F>>>32-16|F<<16,V=V+F|0,o^=V,o=o>>>32-12|o<<12,m=m+P|0,q^=m,q=q>>>32-8|q<<8,K=K+q|0,P^=K,P=P>>>32-7|P<<7,g=g+o|0,F^=g,F=F>>>32-8|F<<8,V=V+F|0,o^=V,o=o>>>32-7|o<<7,w=w+L|0,C^=w,C=C>>>32-8|C<<8,I=I+C|0,L^=I,L=L>>>32-7|L<<7,R=R+d|0,M^=R,M=M>>>32-8|M<<8,J=J+M|0,d^=J,d=d>>>32-7|d<<7;Ze.writeUint32LE(R+n|0,t,0),Ze.writeUint32LE(w+i|0,t,4),Ze.writeUint32LE(m+s|0,t,8),Ze.writeUint32LE(g+f|0,t,12),Ze.writeUint32LE(o+u|0,t,16),Ze.writeUint32LE(d+h|0,t,20),Ze.writeUint32LE(L+c|0,t,24),Ze.writeUint32LE(P+l|0,t,28),Ze.writeUint32LE(K+p|0,t,32),Ze.writeUint32LE(V+_|0,t,36),Ze.writeUint32LE(J+b|0,t,40),Ze.writeUint32LE(I+O|0,t,44),Ze.writeUint32LE(C+A|0,t,48),Ze.writeUint32LE(q+N|0,t,52),Ze.writeUint32LE(F+G|0,t,56),Ze.writeUint32LE(M+E|0,t,60)}function As(t,e,r,n,i){if(i===void 0&&(i=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,f;if(i===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),f=s.length-e.length,s.set(e,f)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,f=i}for(var u=new Uint8Array(64),h=0;h<r.length;h+=64){dl(u,s,t);for(var c=h;c<h+64&&c<r.length;c++)n[c]=r[c]^u[c-h];yl(s,0,f)}return $n.wipe(u),i===0&&$n.wipe(s),n}Fr.streamXOR=As;function gl(t,e,r,n){return n===void 0&&(n=0),$n.wipe(r),As(t,e,r,r,n)}Fr.stream=gl;function yl(t,e,r){for(var n=1;r--;)n=n+(t[e]&255)|0,t[e]=n&255,n>>>=8,e++;if(n>0)throw new Error("ChaCha: counter overflow")}var Ps={},xt={};Object.defineProperty(xt,"__esModule",{value:!0});function _l(t,e,r){return~(t-1)&e|t-1&r}xt.select=_l;function pl(t,e){return(t|0)-(e|0)-1>>>31&1}xt.lessOrEqual=pl;function Ls(t,e){if(t.length!==e.length)return 0;for(var r=0,n=0;n<t.length;n++)r|=t[n]^e[n];return 1&r-1>>>8}xt.compare=Ls;function bl(t,e){return t.length===0||e.length===0?!1:Ls(t,e)!==0}xt.equal=bl,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=xt,r=ct;t.DIGEST_LENGTH=16;var n=function(){function f(u){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=u[0]|u[1]<<8;this._r[0]=h&8191;var c=u[2]|u[3]<<8;this._r[1]=(h>>>13|c<<3)&8191;var l=u[4]|u[5]<<8;this._r[2]=(c>>>10|l<<6)&7939;var p=u[6]|u[7]<<8;this._r[3]=(l>>>7|p<<9)&8191;var _=u[8]|u[9]<<8;this._r[4]=(p>>>4|_<<12)&255,this._r[5]=_>>>1&8190;var b=u[10]|u[11]<<8;this._r[6]=(_>>>14|b<<2)&8191;var O=u[12]|u[13]<<8;this._r[7]=(b>>>11|O<<5)&8065;var A=u[14]|u[15]<<8;this._r[8]=(O>>>8|A<<8)&8191,this._r[9]=A>>>5&127,this._pad[0]=u[16]|u[17]<<8,this._pad[1]=u[18]|u[19]<<8,this._pad[2]=u[20]|u[21]<<8,this._pad[3]=u[22]|u[23]<<8,this._pad[4]=u[24]|u[25]<<8,this._pad[5]=u[26]|u[27]<<8,this._pad[6]=u[28]|u[29]<<8,this._pad[7]=u[30]|u[31]<<8}return f.prototype._blocks=function(u,h,c){for(var l=this._fin?0:2048,p=this._h[0],_=this._h[1],b=this._h[2],O=this._h[3],A=this._h[4],N=this._h[5],G=this._h[6],E=this._h[7],R=this._h[8],w=this._h[9],m=this._r[0],g=this._r[1],o=this._r[2],d=this._r[3],L=this._r[4],P=this._r[5],K=this._r[6],V=this._r[7],J=this._r[8],I=this._r[9];c>=16;){var C=u[h+0]|u[h+1]<<8;p+=C&8191;var q=u[h+2]|u[h+3]<<8;_+=(C>>>13|q<<3)&8191;var F=u[h+4]|u[h+5]<<8;b+=(q>>>10|F<<6)&8191;var M=u[h+6]|u[h+7]<<8;O+=(F>>>7|M<<9)&8191;var j=u[h+8]|u[h+9]<<8;A+=(M>>>4|j<<12)&8191,N+=j>>>1&8191;var U=u[h+10]|u[h+11]<<8;G+=(j>>>14|U<<2)&8191;var B=u[h+12]|u[h+13]<<8;E+=(U>>>11|B<<5)&8191;var ee=u[h+14]|u[h+15]<<8;R+=(B>>>8|ee<<8)&8191,w+=ee>>>5|l;var z=0,Q=z;Q+=p*m,Q+=_*(5*I),Q+=b*(5*J),Q+=O*(5*V),Q+=A*(5*K),z=Q>>>13,Q&=8191,Q+=N*(5*P),Q+=G*(5*L),Q+=E*(5*d),Q+=R*(5*o),Q+=w*(5*g),z+=Q>>>13,Q&=8191;var k=z;k+=p*g,k+=_*m,k+=b*(5*I),k+=O*(5*J),k+=A*(5*V),z=k>>>13,k&=8191,k+=N*(5*K),k+=G*(5*P),k+=E*(5*L),k+=R*(5*d),k+=w*(5*o),z+=k>>>13,k&=8191;var Z=z;Z+=p*o,Z+=_*g,Z+=b*m,Z+=O*(5*I),Z+=A*(5*J),z=Z>>>13,Z&=8191,Z+=N*(5*V),Z+=G*(5*K),Z+=E*(5*P),Z+=R*(5*L),Z+=w*(5*d),z+=Z>>>13,Z&=8191;var x=z;x+=p*d,x+=_*o,x+=b*g,x+=O*m,x+=A*(5*I),z=x>>>13,x&=8191,x+=N*(5*J),x+=G*(5*V),x+=E*(5*K),x+=R*(5*P),x+=w*(5*L),z+=x>>>13,x&=8191;var T=z;T+=p*L,T+=_*d,T+=b*o,T+=O*g,T+=A*m,z=T>>>13,T&=8191,T+=N*(5*I),T+=G*(5*J),T+=E*(5*V),T+=R*(5*K),T+=w*(5*P),z+=T>>>13,T&=8191;var D=z;D+=p*P,D+=_*L,D+=b*d,D+=O*o,D+=A*g,z=D>>>13,D&=8191,D+=N*m,D+=G*(5*I),D+=E*(5*J),D+=R*(5*V),D+=w*(5*K),z+=D>>>13,D&=8191;var a=z;a+=p*K,a+=_*P,a+=b*L,a+=O*d,a+=A*o,z=a>>>13,a&=8191,a+=N*g,a+=G*m,a+=E*(5*I),a+=R*(5*J),a+=w*(5*V),z+=a>>>13,a&=8191;var v=z;v+=p*V,v+=_*K,v+=b*P,v+=O*L,v+=A*d,z=v>>>13,v&=8191,v+=N*o,v+=G*g,v+=E*m,v+=R*(5*I),v+=w*(5*J),z+=v>>>13,v&=8191;var H=z;H+=p*J,H+=_*V,H+=b*K,H+=O*P,H+=A*L,z=H>>>13,H&=8191,H+=N*d,H+=G*o,H+=E*g,H+=R*m,H+=w*(5*I),z+=H>>>13,H&=8191;var Y=z;Y+=p*I,Y+=_*J,Y+=b*V,Y+=O*K,Y+=A*P,z=Y>>>13,Y&=8191,Y+=N*L,Y+=G*d,Y+=E*o,Y+=R*g,Y+=w*m,z+=Y>>>13,Y&=8191,z=(z<<2)+z|0,z=z+Q|0,Q=z&8191,z=z>>>13,k+=z,p=Q,_=k,b=Z,O=x,A=T,N=D,G=a,E=v,R=H,w=Y,h+=16,c-=16}this._h[0]=p,this._h[1]=_,this._h[2]=b,this._h[3]=O,this._h[4]=A,this._h[5]=N,this._h[6]=G,this._h[7]=E,this._h[8]=R,this._h[9]=w},f.prototype.finish=function(u,h){h===void 0&&(h=0);var c=new Uint16Array(10),l,p,_,b;if(this._leftover){for(b=this._leftover,this._buffer[b++]=1;b<16;b++)this._buffer[b]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(l=this._h[1]>>>13,this._h[1]&=8191,b=2;b<10;b++)this._h[b]+=l,l=this._h[b]>>>13,this._h[b]&=8191;for(this._h[0]+=l*5,l=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=l,l=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=l,c[0]=this._h[0]+5,l=c[0]>>>13,c[0]&=8191,b=1;b<10;b++)c[b]=this._h[b]+l,l=c[b]>>>13,c[b]&=8191;for(c[9]-=8192,p=(l^1)-1,b=0;b<10;b++)c[b]&=p;for(p=~p,b=0;b<10;b++)this._h[b]=this._h[b]&p|c[b];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,_=this._h[0]+this._pad[0],this._h[0]=_&65535,b=1;b<8;b++)_=(this._h[b]+this._pad[b]|0)+(_>>>16)|0,this._h[b]=_&65535;return u[h+0]=this._h[0]>>>0,u[h+1]=this._h[0]>>>8,u[h+2]=this._h[1]>>>0,u[h+3]=this._h[1]>>>8,u[h+4]=this._h[2]>>>0,u[h+5]=this._h[2]>>>8,u[h+6]=this._h[3]>>>0,u[h+7]=this._h[3]>>>8,u[h+8]=this._h[4]>>>0,u[h+9]=this._h[4]>>>8,u[h+10]=this._h[5]>>>0,u[h+11]=this._h[5]>>>8,u[h+12]=this._h[6]>>>0,u[h+13]=this._h[6]>>>8,u[h+14]=this._h[7]>>>0,u[h+15]=this._h[7]>>>8,this._finished=!0,this},f.prototype.update=function(u){var h=0,c=u.length,l;if(this._leftover){l=16-this._leftover,l>c&&(l=c);for(var p=0;p<l;p++)this._buffer[this._leftover+p]=u[h+p];if(c-=l,h+=l,this._leftover+=l,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(c>=16&&(l=c-c%16,this._blocks(u,h,l),h+=l,c-=l),c){for(var p=0;p<c;p++)this._buffer[this._leftover+p]=u[h+p];this._leftover+=c}return this},f.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var u=new Uint8Array(16);return this.finish(u),u},f.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},f}();t.Poly1305=n;function i(f,u){var h=new n(f);h.update(u);var c=h.digest();return h.clean(),c}t.oneTimeAuth=i;function s(f,u){return f.length!==t.DIGEST_LENGTH||u.length!==t.DIGEST_LENGTH?!1:e.equal(f,u)}t.equal=s}(Ps),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Fr,r=Ps,n=ct,i=re,s=xt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var f=new Uint8Array(16),u=function(){function h(c){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,c.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(c)}return h.prototype.seal=function(c,l,p,_){if(c.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var b=new Uint8Array(16);b.set(c,b.length-c.length);var O=new Uint8Array(32);e.stream(this._key,b,O,4);var A=l.length+this.tagLength,N;if(_){if(_.length!==A)throw new Error("ChaCha20Poly1305: incorrect destination length");N=_}else N=new Uint8Array(A);return e.streamXOR(this._key,b,l,N,4),this._authenticate(N.subarray(N.length-this.tagLength,N.length),O,N.subarray(0,N.length-this.tagLength),p),n.wipe(b),N},h.prototype.open=function(c,l,p,_){if(c.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(l.length<this.tagLength)return null;var b=new Uint8Array(16);b.set(c,b.length-c.length);var O=new Uint8Array(32);e.stream(this._key,b,O,4);var A=new Uint8Array(this.tagLength);if(this._authenticate(A,O,l.subarray(0,l.length-this.tagLength),p),!s.equal(A,l.subarray(l.length-this.tagLength,l.length)))return null;var N=l.length-this.tagLength,G;if(_){if(_.length!==N)throw new Error("ChaCha20Poly1305: incorrect destination length");G=_}else G=new Uint8Array(N);return e.streamXOR(this._key,b,l.subarray(0,l.length-this.tagLength),G,4),n.wipe(b),G},h.prototype.clean=function(){return n.wipe(this._key),this},h.prototype._authenticate=function(c,l,p,_){var b=new r.Poly1305(l);_&&(b.update(_),_.length%16>0&&b.update(f.subarray(_.length%16))),b.update(p),p.length%16>0&&b.update(f.subarray(p.length%16));var O=new Uint8Array(8);_&&i.writeUint64LE(_.length,O),b.update(O),i.writeUint64LE(p.length,O),b.update(O);for(var A=b.digest(),N=0;N<A.length;N++)c[N]=A[N];b.clean(),n.wipe(A),n.wipe(O)},h}();t.ChaCha20Poly1305=u}(Mn);var Ns={},hr={},jn={};Object.defineProperty(jn,"__esModule",{value:!0});function vl(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}jn.isSerializableHash=vl,Object.defineProperty(hr,"__esModule",{value:!0});var wt=jn,wl=xt,ml=ct,Us=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(n).clean():n.set(r);for(var i=0;i<n.length;i++)n[i]^=54;this._inner.update(n);for(var i=0;i<n.length;i++)n[i]^=106;this._outer.update(n),wt.isSerializableHash(this._inner)&&wt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),ml.wipe(n)}return t.prototype.reset=function(){if(!wt.isSerializableHash(this._inner)||!wt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){wt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),wt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!wt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!wt.isSerializableHash(this._inner)||!wt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!wt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();hr.HMAC=Us;function El(t,e,r){var n=new Us(t,e);n.update(r);var i=n.digest();return n.clean(),i}hr.hmac=El,hr.equal=wl.equal,Object.defineProperty(Ns,"__esModule",{value:!0});var Ms=hr,$s=ct,Dl=function(){function t(e,r,n,i){n===void 0&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=i;var s=Ms.hmac(this._hash,n,r);this._hmac=new Ms.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),n=0;n<r.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[n]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),$s.wipe(this._buffer),$s.wipe(this._counter),this._bufpos=0},t}(),Sl=Ns.HKDF=Dl,Br={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ct;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var n=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},u.prototype.update=function(h,c){if(c===void 0&&(c=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var l=0;if(this._bytesHashed+=c,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&c>0;)this._buffer[this._bufferLength++]=h[l++],c--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(c>=this.blockSize&&(l=s(this._temp,this._state,h,l,c),c%=this.blockSize);c>0;)this._buffer[this._bufferLength++]=h[l++],c--;return this},u.prototype.finish=function(h){if(!this._finished){var c=this._bytesHashed,l=this._bufferLength,p=c/536870912|0,_=c<<3,b=c%64<56?64:128;this._buffer[l]=128;for(var O=l+1;O<b-8;O++)this._buffer[O]=0;e.writeUint32BE(p,this._buffer,b-8),e.writeUint32BE(_,this._buffer,b-4),s(this._temp,this._state,this._buffer,0,b),this._finished=!0}for(var O=0;O<this.digestLength/4;O++)e.writeUint32BE(this._state[O],h,O*4);return this},u.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},u}();t.SHA256=n;var i=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(u,h,c,l,p){for(;p>=64;){for(var _=h[0],b=h[1],O=h[2],A=h[3],N=h[4],G=h[5],E=h[6],R=h[7],w=0;w<16;w++){var m=l+w*4;u[w]=e.readUint32BE(c,m)}for(var w=16;w<64;w++){var g=u[w-2],o=(g>>>17|g<<32-17)^(g>>>19|g<<32-19)^g>>>10;g=u[w-15];var d=(g>>>7|g<<32-7)^(g>>>18|g<<32-18)^g>>>3;u[w]=(o+u[w-7]|0)+(d+u[w-16]|0)}for(var w=0;w<64;w++){var o=(((N>>>6|N<<26)^(N>>>11|N<<21)^(N>>>25|N<<7))+(N&G^~N&E)|0)+(R+(i[w]+u[w]|0)|0)|0,d=((_>>>2|_<<32-2)^(_>>>13|_<<32-13)^(_>>>22|_<<32-22))+(_&b^_&O^b&O)|0;R=E,E=G,G=N,N=A+o|0,A=O,O=b,b=_,_=o+d|0}h[0]+=_,h[1]+=b,h[2]+=O,h[3]+=A,h[4]+=N,h[5]+=G,h[6]+=E,h[7]+=R,l+=64,p-=64}return l}function f(u){var h=new n;h.update(u);var c=h.digest();return h.clean(),c}t.hash=f})(Br);var Fn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=Yt,r=ct;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function n(w){const m=new Float64Array(16);if(w)for(let g=0;g<w.length;g++)m[g]=w[g];return m}const i=new Uint8Array(32);i[0]=9;const s=n([56129,1]);function f(w){let m=1;for(let g=0;g<16;g++){let o=w[g]+m+65535;m=Math.floor(o/65536),w[g]=o-m*65536}w[0]+=m-1+37*(m-1)}function u(w,m,g){const o=~(g-1);for(let d=0;d<16;d++){const L=o&(w[d]^m[d]);w[d]^=L,m[d]^=L}}function h(w,m){const g=n(),o=n();for(let d=0;d<16;d++)o[d]=m[d];f(o),f(o),f(o);for(let d=0;d<2;d++){g[0]=o[0]-65517;for(let P=1;P<15;P++)g[P]=o[P]-65535-(g[P-1]>>16&1),g[P-1]&=65535;g[15]=o[15]-32767-(g[14]>>16&1);const L=g[15]>>16&1;g[14]&=65535,u(o,g,1-L)}for(let d=0;d<16;d++)w[2*d]=o[d]&255,w[2*d+1]=o[d]>>8}function c(w,m){for(let g=0;g<16;g++)w[g]=m[2*g]+(m[2*g+1]<<8);w[15]&=32767}function l(w,m,g){for(let o=0;o<16;o++)w[o]=m[o]+g[o]}function p(w,m,g){for(let o=0;o<16;o++)w[o]=m[o]-g[o]}function _(w,m,g){let o,d,L=0,P=0,K=0,V=0,J=0,I=0,C=0,q=0,F=0,M=0,j=0,U=0,B=0,ee=0,z=0,Q=0,k=0,Z=0,x=0,T=0,D=0,a=0,v=0,H=0,Y=0,he=0,pe=0,de=0,we=0,Ue=0,Ae=0,_e=g[0],ge=g[1],le=g[2],ue=g[3],ce=g[4],oe=g[5],se=g[6],te=g[7],fe=g[8],ye=g[9],ne=g[10],be=g[11],ve=g[12],De=g[13],Se=g[14],me=g[15];o=m[0],L+=o*_e,P+=o*ge,K+=o*le,V+=o*ue,J+=o*ce,I+=o*oe,C+=o*se,q+=o*te,F+=o*fe,M+=o*ye,j+=o*ne,U+=o*be,B+=o*ve,ee+=o*De,z+=o*Se,Q+=o*me,o=m[1],P+=o*_e,K+=o*ge,V+=o*le,J+=o*ue,I+=o*ce,C+=o*oe,q+=o*se,F+=o*te,M+=o*fe,j+=o*ye,U+=o*ne,B+=o*be,ee+=o*ve,z+=o*De,Q+=o*Se,k+=o*me,o=m[2],K+=o*_e,V+=o*ge,J+=o*le,I+=o*ue,C+=o*ce,q+=o*oe,F+=o*se,M+=o*te,j+=o*fe,U+=o*ye,B+=o*ne,ee+=o*be,z+=o*ve,Q+=o*De,k+=o*Se,Z+=o*me,o=m[3],V+=o*_e,J+=o*ge,I+=o*le,C+=o*ue,q+=o*ce,F+=o*oe,M+=o*se,j+=o*te,U+=o*fe,B+=o*ye,ee+=o*ne,z+=o*be,Q+=o*ve,k+=o*De,Z+=o*Se,x+=o*me,o=m[4],J+=o*_e,I+=o*ge,C+=o*le,q+=o*ue,F+=o*ce,M+=o*oe,j+=o*se,U+=o*te,B+=o*fe,ee+=o*ye,z+=o*ne,Q+=o*be,k+=o*ve,Z+=o*De,x+=o*Se,T+=o*me,o=m[5],I+=o*_e,C+=o*ge,q+=o*le,F+=o*ue,M+=o*ce,j+=o*oe,U+=o*se,B+=o*te,ee+=o*fe,z+=o*ye,Q+=o*ne,k+=o*be,Z+=o*ve,x+=o*De,T+=o*Se,D+=o*me,o=m[6],C+=o*_e,q+=o*ge,F+=o*le,M+=o*ue,j+=o*ce,U+=o*oe,B+=o*se,ee+=o*te,z+=o*fe,Q+=o*ye,k+=o*ne,Z+=o*be,x+=o*ve,T+=o*De,D+=o*Se,a+=o*me,o=m[7],q+=o*_e,F+=o*ge,M+=o*le,j+=o*ue,U+=o*ce,B+=o*oe,ee+=o*se,z+=o*te,Q+=o*fe,k+=o*ye,Z+=o*ne,x+=o*be,T+=o*ve,D+=o*De,a+=o*Se,v+=o*me,o=m[8],F+=o*_e,M+=o*ge,j+=o*le,U+=o*ue,B+=o*ce,ee+=o*oe,z+=o*se,Q+=o*te,k+=o*fe,Z+=o*ye,x+=o*ne,T+=o*be,D+=o*ve,a+=o*De,v+=o*Se,H+=o*me,o=m[9],M+=o*_e,j+=o*ge,U+=o*le,B+=o*ue,ee+=o*ce,z+=o*oe,Q+=o*se,k+=o*te,Z+=o*fe,x+=o*ye,T+=o*ne,D+=o*be,a+=o*ve,v+=o*De,H+=o*Se,Y+=o*me,o=m[10],j+=o*_e,U+=o*ge,B+=o*le,ee+=o*ue,z+=o*ce,Q+=o*oe,k+=o*se,Z+=o*te,x+=o*fe,T+=o*ye,D+=o*ne,a+=o*be,v+=o*ve,H+=o*De,Y+=o*Se,he+=o*me,o=m[11],U+=o*_e,B+=o*ge,ee+=o*le,z+=o*ue,Q+=o*ce,k+=o*oe,Z+=o*se,x+=o*te,T+=o*fe,D+=o*ye,a+=o*ne,v+=o*be,H+=o*ve,Y+=o*De,he+=o*Se,pe+=o*me,o=m[12],B+=o*_e,ee+=o*ge,z+=o*le,Q+=o*ue,k+=o*ce,Z+=o*oe,x+=o*se,T+=o*te,D+=o*fe,a+=o*ye,v+=o*ne,H+=o*be,Y+=o*ve,he+=o*De,pe+=o*Se,de+=o*me,o=m[13],ee+=o*_e,z+=o*ge,Q+=o*le,k+=o*ue,Z+=o*ce,x+=o*oe,T+=o*se,D+=o*te,a+=o*fe,v+=o*ye,H+=o*ne,Y+=o*be,he+=o*ve,pe+=o*De,de+=o*Se,we+=o*me,o=m[14],z+=o*_e,Q+=o*ge,k+=o*le,Z+=o*ue,x+=o*ce,T+=o*oe,D+=o*se,a+=o*te,v+=o*fe,H+=o*ye,Y+=o*ne,he+=o*be,pe+=o*ve,de+=o*De,we+=o*Se,Ue+=o*me,o=m[15],Q+=o*_e,k+=o*ge,Z+=o*le,x+=o*ue,T+=o*ce,D+=o*oe,a+=o*se,v+=o*te,H+=o*fe,Y+=o*ye,he+=o*ne,pe+=o*be,de+=o*ve,we+=o*De,Ue+=o*Se,Ae+=o*me,L+=38*k,P+=38*Z,K+=38*x,V+=38*T,J+=38*D,I+=38*a,C+=38*v,q+=38*H,F+=38*Y,M+=38*he,j+=38*pe,U+=38*de,B+=38*we,ee+=38*Ue,z+=38*Ae,d=1,o=L+d+65535,d=Math.floor(o/65536),L=o-d*65536,o=P+d+65535,d=Math.floor(o/65536),P=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=V+d+65535,d=Math.floor(o/65536),V=o-d*65536,o=J+d+65535,d=Math.floor(o/65536),J=o-d*65536,o=I+d+65535,d=Math.floor(o/65536),I=o-d*65536,o=C+d+65535,d=Math.floor(o/65536),C=o-d*65536,o=q+d+65535,d=Math.floor(o/65536),q=o-d*65536,o=F+d+65535,d=Math.floor(o/65536),F=o-d*65536,o=M+d+65535,d=Math.floor(o/65536),M=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,o=U+d+65535,d=Math.floor(o/65536),U=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=ee+d+65535,d=Math.floor(o/65536),ee=o-d*65536,o=z+d+65535,d=Math.floor(o/65536),z=o-d*65536,o=Q+d+65535,d=Math.floor(o/65536),Q=o-d*65536,L+=d-1+37*(d-1),d=1,o=L+d+65535,d=Math.floor(o/65536),L=o-d*65536,o=P+d+65535,d=Math.floor(o/65536),P=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=V+d+65535,d=Math.floor(o/65536),V=o-d*65536,o=J+d+65535,d=Math.floor(o/65536),J=o-d*65536,o=I+d+65535,d=Math.floor(o/65536),I=o-d*65536,o=C+d+65535,d=Math.floor(o/65536),C=o-d*65536,o=q+d+65535,d=Math.floor(o/65536),q=o-d*65536,o=F+d+65535,d=Math.floor(o/65536),F=o-d*65536,o=M+d+65535,d=Math.floor(o/65536),M=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,o=U+d+65535,d=Math.floor(o/65536),U=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=ee+d+65535,d=Math.floor(o/65536),ee=o-d*65536,o=z+d+65535,d=Math.floor(o/65536),z=o-d*65536,o=Q+d+65535,d=Math.floor(o/65536),Q=o-d*65536,L+=d-1+37*(d-1),w[0]=L,w[1]=P,w[2]=K,w[3]=V,w[4]=J,w[5]=I,w[6]=C,w[7]=q,w[8]=F,w[9]=M,w[10]=j,w[11]=U,w[12]=B,w[13]=ee,w[14]=z,w[15]=Q}function b(w,m){_(w,m,m)}function O(w,m){const g=n();for(let o=0;o<16;o++)g[o]=m[o];for(let o=253;o>=0;o--)b(g,g),o!==2&&o!==4&&_(g,g,m);for(let o=0;o<16;o++)w[o]=g[o]}function A(w,m){const g=new Uint8Array(32),o=new Float64Array(80),d=n(),L=n(),P=n(),K=n(),V=n(),J=n();for(let F=0;F<31;F++)g[F]=w[F];g[31]=w[31]&127|64,g[0]&=248,c(o,m);for(let F=0;F<16;F++)L[F]=o[F];d[0]=K[0]=1;for(let F=254;F>=0;--F){const M=g[F>>>3]>>>(F&7)&1;u(d,L,M),u(P,K,M),l(V,d,P),p(d,d,P),l(P,L,K),p(L,L,K),b(K,V),b(J,d),_(d,P,d),_(P,L,V),l(V,d,P),p(d,d,P),b(L,d),p(P,K,J),_(d,P,s),l(d,d,K),_(P,P,d),_(d,K,J),_(K,L,o),b(L,V),u(d,L,M),u(P,K,M)}for(let F=0;F<16;F++)o[F+16]=d[F],o[F+32]=P[F],o[F+48]=L[F],o[F+64]=K[F];const I=o.subarray(32),C=o.subarray(16);O(I,I),_(C,C,I);const q=new Uint8Array(32);return h(q,C),q}t.scalarMult=A;function N(w){return A(w,i)}t.scalarMultBase=N;function G(w){if(w.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const m=new Uint8Array(w);return{publicKey:N(m),secretKey:m}}t.generateKeyPairFromSeed=G;function E(w){const m=(0,e.randomBytes)(32,w),g=G(m);return(0,r.wipe)(m),g}t.generateKeyPair=E;function R(w,m,g=!1){if(w.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(m.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const o=A(w,m);if(g){let d=0;for(let L=0;L<o.length;L++)d|=o[L];if(d===0)throw new Error("X25519: invalid shared key")}return o}t.sharedKey=R})(Fn);var js=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},Ol=function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t}(),Il=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Tl=function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t}(),xl=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Rl=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Cl=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Al=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Fs=3,Pl=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Cl]],Bs=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Ll(t){return t?zs(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Rl:typeof navigator<"u"?zs(navigator.userAgent):Ml()}function Nl(t){return t!==""&&Pl.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function zs(t){var e=Nl(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new xl;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<Fs&&(i=js(js([],i,!0),$l(Fs-i.length),!0)):i=[];var s=i.join("."),f=Ul(t),u=Al.exec(t);return u&&u[1]?new Tl(r,s,f,u[1]):new Ol(r,s,f)}function Ul(t){for(var e=0,r=Bs.length;e<r;e++){var n=Bs[e],i=n[0],s=n[1],f=s.exec(t);if(f)return i}return null}function Ml(){var t=typeof process<"u"&&process.version;return t?new Il(process.version.slice(1)):null}function $l(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Te={};Object.defineProperty(Te,"__esModule",{value:!0}),Te.getLocalStorage=Te.getLocalStorageOrThrow=Te.getCrypto=Te.getCryptoOrThrow=Ks=Te.getLocation=Te.getLocationOrThrow=zn=Te.getNavigator=Te.getNavigatorOrThrow=Bn=Te.getDocument=Te.getDocumentOrThrow=Te.getFromWindowOrThrow=Te.getFromWindow=void 0;function Bt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Te.getFromWindow=Bt;function kt(t){const e=Bt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Te.getFromWindowOrThrow=kt;function jl(){return kt("document")}Te.getDocumentOrThrow=jl;function Fl(){return Bt("document")}var Bn=Te.getDocument=Fl;function Bl(){return kt("navigator")}Te.getNavigatorOrThrow=Bl;function zl(){return Bt("navigator")}var zn=Te.getNavigator=zl;function Kl(){return kt("location")}Te.getLocationOrThrow=Kl;function Hl(){return Bt("location")}var Ks=Te.getLocation=Hl;function Gl(){return kt("crypto")}Te.getCryptoOrThrow=Gl;function Vl(){return Bt("crypto")}Te.getCrypto=Vl;function Wl(){return kt("localStorage")}Te.getLocalStorageOrThrow=Wl;function ql(){return Bt("localStorage")}Te.getLocalStorage=ql;var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.getWindowMetadata=void 0;const Hs=Te;function Yl(){let t,e;try{t=Hs.getDocumentOrThrow(),e=Hs.getLocationOrThrow()}catch{return null}function r(){const p=t.getElementsByTagName("link"),_=[];for(let b=0;b<p.length;b++){const O=p[b],A=O.getAttribute("rel");if(A&&A.toLowerCase().indexOf("icon")>-1){const N=O.getAttribute("href");if(N)if(N.toLowerCase().indexOf("https:")===-1&&N.toLowerCase().indexOf("http:")===-1&&N.indexOf("//")!==0){let G=e.protocol+"//"+e.host;if(N.indexOf("/")===0)G+=N;else{const E=e.pathname.split("/");E.pop();const R=E.join("/");G+=R+"/"+N}_.push(G)}else if(N.indexOf("//")===0){const G=e.protocol+N;_.push(G)}else _.push(N)}}return _}function n(...p){const _=t.getElementsByTagName("meta");for(let b=0;b<_.length;b++){const O=_[b],A=["itemprop","property","name"].map(N=>O.getAttribute(N)).filter(N=>N?p.includes(N):!1);if(A.length&&A){const N=O.getAttribute("content");if(N)return N}}return""}function i(){let p=n("name","og:site_name","og:title","twitter:title");return p||(p=t.title),p}function s(){return n("description","og:description","twitter:description","keywords")}const f=i(),u=s(),h=e.origin,c=r();return{description:u,url:h,icons:c,name:f}}Kn.getWindowMetadata=Yl;var lr={},kl=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Gs="%[a-f0-9]{2}",Vs=new RegExp("("+Gs+")|([^%]+?)","gi"),Ws=new RegExp("("+Gs+")+","gi");function Hn(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),n=t.slice(e);return Array.prototype.concat.call([],Hn(r),Hn(n))}function Xl(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(Vs)||[],r=1;r<e.length;r++)t=Hn(e,r).join(""),e=t.match(Vs)||[];return t}}function Jl(t){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},r=Ws.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var n=Xl(r[0]);n!==r[0]&&(e[r[0]]=n)}r=Ws.exec(t)}e["%C2"]="\uFFFD";for(var i=Object.keys(e),s=0;s<i.length;s++){var f=i[s];t=t.replace(new RegExp(f,"g"),e[f])}return t}var Ql=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Jl(t)}},Zl=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},ed=function(t,e){for(var r={},n=Object.keys(t),i=Array.isArray(e),s=0;s<n.length;s++){var f=n[s],u=t[f];(i?e.indexOf(f)!==-1:e(f,u,t))&&(r[f]=u)}return r};(function(t){const e=kl,r=Ql,n=Zl,i=ed,s=E=>E==null,f=Symbol("encodeFragmentIdentifier");function u(E){switch(E.arrayFormat){case"index":return R=>(w,m)=>{const g=w.length;return m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,[l(R,E),"[",g,"]"].join("")]:[...w,[l(R,E),"[",l(g,E),"]=",l(m,E)].join("")]};case"bracket":return R=>(w,m)=>m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,[l(R,E),"[]"].join("")]:[...w,[l(R,E),"[]=",l(m,E)].join("")];case"colon-list-separator":return R=>(w,m)=>m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,[l(R,E),":list="].join("")]:[...w,[l(R,E),":list=",l(m,E)].join("")];case"comma":case"separator":case"bracket-separator":{const R=E.arrayFormat==="bracket-separator"?"[]=":"=";return w=>(m,g)=>g===void 0||E.skipNull&&g===null||E.skipEmptyString&&g===""?m:(g=g===null?"":g,m.length===0?[[l(w,E),R,l(g,E)].join("")]:[[m,l(g,E)].join(E.arrayFormatSeparator)])}default:return R=>(w,m)=>m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,l(R,E)]:[...w,[l(R,E),"=",l(m,E)].join("")]}}function h(E){let R;switch(E.arrayFormat){case"index":return(w,m,g)=>{if(R=/\[(\d*)\]$/.exec(w),w=w.replace(/\[\d*\]$/,""),!R){g[w]=m;return}g[w]===void 0&&(g[w]={}),g[w][R[1]]=m};case"bracket":return(w,m,g)=>{if(R=/(\[\])$/.exec(w),w=w.replace(/\[\]$/,""),!R){g[w]=m;return}if(g[w]===void 0){g[w]=[m];return}g[w]=[].concat(g[w],m)};case"colon-list-separator":return(w,m,g)=>{if(R=/(:list)$/.exec(w),w=w.replace(/:list$/,""),!R){g[w]=m;return}if(g[w]===void 0){g[w]=[m];return}g[w]=[].concat(g[w],m)};case"comma":case"separator":return(w,m,g)=>{const o=typeof m=="string"&&m.includes(E.arrayFormatSeparator),d=typeof m=="string"&&!o&&p(m,E).includes(E.arrayFormatSeparator);m=d?p(m,E):m;const L=o||d?m.split(E.arrayFormatSeparator).map(P=>p(P,E)):m===null?m:p(m,E);g[w]=L};case"bracket-separator":return(w,m,g)=>{const o=/(\[\])$/.test(w);if(w=w.replace(/\[\]$/,""),!o){g[w]=m&&p(m,E);return}const d=m===null?[]:m.split(E.arrayFormatSeparator).map(L=>p(L,E));if(g[w]===void 0){g[w]=d;return}g[w]=[].concat(g[w],d)};default:return(w,m,g)=>{if(g[w]===void 0){g[w]=m;return}g[w]=[].concat(g[w],m)}}}function c(E){if(typeof E!="string"||E.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(E,R){return R.encode?R.strict?e(E):encodeURIComponent(E):E}function p(E,R){return R.decode?r(E):E}function _(E){return Array.isArray(E)?E.sort():typeof E=="object"?_(Object.keys(E)).sort((R,w)=>Number(R)-Number(w)).map(R=>E[R]):E}function b(E){const R=E.indexOf("#");return R!==-1&&(E=E.slice(0,R)),E}function O(E){let R="";const w=E.indexOf("#");return w!==-1&&(R=E.slice(w)),R}function A(E){E=b(E);const R=E.indexOf("?");return R===-1?"":E.slice(R+1)}function N(E,R){return R.parseNumbers&&!Number.isNaN(Number(E))&&typeof E=="string"&&E.trim()!==""?E=Number(E):R.parseBooleans&&E!==null&&(E.toLowerCase()==="true"||E.toLowerCase()==="false")&&(E=E.toLowerCase()==="true"),E}function G(E,R){R=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},R),c(R.arrayFormatSeparator);const w=h(R),m=Object.create(null);if(typeof E!="string"||(E=E.trim().replace(/^[?#&]/,""),!E))return m;for(const g of E.split("&")){if(g==="")continue;let[o,d]=n(R.decode?g.replace(/\+/g," "):g,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(R.arrayFormat)?d:p(d,R),w(p(o,R),d,m)}for(const g of Object.keys(m)){const o=m[g];if(typeof o=="object"&&o!==null)for(const d of Object.keys(o))o[d]=N(o[d],R);else m[g]=N(o,R)}return R.sort===!1?m:(R.sort===!0?Object.keys(m).sort():Object.keys(m).sort(R.sort)).reduce((g,o)=>{const d=m[o];return d&&typeof d=="object"&&!Array.isArray(d)?g[o]=_(d):g[o]=d,g},Object.create(null))}t.extract=A,t.parse=G,t.stringify=(E,R)=>{if(!E)return"";R=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},R),c(R.arrayFormatSeparator);const w=d=>R.skipNull&&s(E[d])||R.skipEmptyString&&E[d]==="",m=u(R),g={};for(const d of Object.keys(E))w(d)||(g[d]=E[d]);const o=Object.keys(g);return R.sort!==!1&&o.sort(R.sort),o.map(d=>{const L=E[d];return L===void 0?"":L===null?l(d,R):Array.isArray(L)?L.length===0&&R.arrayFormat==="bracket-separator"?l(d,R)+"[]":L.reduce(m(d),[]).join("&"):l(d,R)+"="+l(L,R)}).filter(d=>d.length>0).join("&")},t.parseUrl=(E,R)=>{R=Object.assign({decode:!0},R);const[w,m]=n(E,"#");return Object.assign({url:w.split("?")[0]||"",query:G(A(E),R)},R&&R.parseFragmentIdentifier&&m?{fragmentIdentifier:p(m,R)}:{})},t.stringifyUrl=(E,R)=>{R=Object.assign({encode:!0,strict:!0,[f]:!0},R);const w=b(E.url).split("?")[0]||"",m=t.extract(E.url),g=t.parse(m,{sort:!1}),o=Object.assign(g,E.query);let d=t.stringify(o,R);d&&(d=`?${d}`);let L=O(E.url);return E.fragmentIdentifier&&(L=`#${R[f]?l(E.fragmentIdentifier,R):E.fragmentIdentifier}`),`${w}${d}${L}`},t.pick=(E,R,w)=>{w=Object.assign({parseFragmentIdentifier:!0,[f]:!1},w);const{url:m,query:g,fragmentIdentifier:o}=t.parseUrl(E,w);return t.stringifyUrl({url:m,query:i(g,R),fragmentIdentifier:o},w)},t.exclude=(E,R,w)=>{const m=Array.isArray(R)?g=>!R.includes(g):(g,o)=>!R(g,o);return t.pick(E,m,w)}})(lr);const td={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}},qs="base10",it="base16",Gn="base64pad",Vn="utf8",Ys=0,Xt=1,rd=0,ks=1,Wn=12,qn=32;function nd(){const t=Fn.generateKeyPair();return{privateKey:rt(t.secretKey,it),publicKey:rt(t.publicKey,it)}}function Yn(){const t=Yt.randomBytes(qn);return rt(t,it)}function id(t,e){const r=Fn.sharedKey(nt(t,it),nt(e,it),!0),n=new Sl(Br.SHA256,r).expand(qn);return rt(n,it)}function sd(t){const e=Br.hash(nt(t,it));return rt(e,it)}function kn(t){const e=Br.hash(nt(t,Vn));return rt(e,it)}function od(t){return nt(`${t}`,qs)}function dr(t){return Number(rt(t,qs))}function ad(t){const e=od(typeof t.type<"u"?t.type:Ys);if(dr(e)===Xt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?nt(t.senderPublicKey,it):void 0,n=typeof t.iv<"u"?nt(t.iv,it):Yt.randomBytes(Wn),i=new Mn.ChaCha20Poly1305(nt(t.symKey,it)).seal(n,nt(t.message,Vn));return ud({type:e,sealed:i,iv:n,senderPublicKey:r})}function cd(t){const e=new Mn.ChaCha20Poly1305(nt(t.symKey,it)),{sealed:r,iv:n}=zr(t.encoded),i=e.open(n,r);if(i===null)throw new Error("Failed to decrypt");return rt(i,Vn)}function ud(t){if(dr(t.type)===Xt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return rt(Pn([t.type,t.senderPublicKey,t.iv,t.sealed]),Gn)}return rt(Pn([t.type,t.iv,t.sealed]),Gn)}function zr(t){const e=nt(t,Gn),r=e.slice(rd,ks),n=ks;if(dr(r)===Xt){const u=n+qn,h=u+Wn,c=e.slice(n,u),l=e.slice(u,h),p=e.slice(h);return{type:r,sealed:p,iv:l,senderPublicKey:c}}const i=n+Wn,s=e.slice(n,i),f=e.slice(i);return{type:r,sealed:f,iv:s}}function fd(t,e){const r=zr(t);return Xs({type:dr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?rt(r.senderPublicKey,it):void 0,receiverPublicKey:e?.receiverPublicKey})}function Xs(t){const e=t?.type||Ys;if(e===Xt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Js(t){return t.type===Xt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var hd=Object.defineProperty,Qs=Object.getOwnPropertySymbols,ld=Object.prototype.hasOwnProperty,dd=Object.prototype.propertyIsEnumerable,Zs=(t,e,r)=>e in t?hd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eo=(t,e)=>{for(var r in e||(e={}))ld.call(e,r)&&Zs(t,r,e[r]);if(Qs)for(var r of Qs(e))dd.call(e,r)&&Zs(t,r,e[r]);return t};const gd="ReactNative",_t={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},yd="js";function Xn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Jt(){return!Bn()&&!!zn()&&navigator.product===gd}function Kr(){return!Xn()&&!!zn()&&!!Bn()}function Hr(){return Jt()?_t.reactNative:Xn()?_t.node:Kr()?_t.browser:_t.unknown}function _d(){var t;try{return Jt()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function pd(t,e){let r=lr.parse(t);return r=eo(eo({},r),e),t=lr.stringify(r),t}function bd(){if(Hr()===_t.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=Ll();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function vd(){var t;const e=Hr();return e===_t.browser?[e,((t=Ks())==null?void 0:t.host)||"unknown"].join(":"):e}function wd(t,e,r){const n=bd(),i=vd();return[[t,e].join("-"),[yd,r].join("-"),n,i].join("/")}function md({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:f,bundleId:u}){const h=r.split("?"),c=wd(t,e,n),l={auth:i,ua:c,projectId:s,useOnCloseEvent:f||void 0,origin:u||void 0},p=pd(h[1]||"",l);return h[0]+"?"+p}function to(t){return Object.fromEntries(t.entries())}function ro(t){return new Map(Object.entries(t))}function Ed(t=ae.FIVE_MINUTES,e){const r=ae.toMiliseconds(t||ae.FIVE_MINUTES);let n,i,s;return{resolve:f=>{s&&n&&(clearTimeout(s),n(f))},reject:f=>{s&&i&&(clearTimeout(s),i(f))},done:()=>new Promise((f,u)=>{s=setTimeout(()=>{u(new Error(e))},r),n=f,i=u})}}function gr(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const f=await t;n(f)}catch(f){i(f)}clearTimeout(s)})}function no(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Dd(t){return no("topic",t)}function Sd(t){return no("id",t)}function Od(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Gr(t,e){return ae.fromMiliseconds((e||Date.now())+ae.toMiliseconds(t))}function io(t){return Date.now()>=ae.toMiliseconds(t)}function Jn(t,e){return`${t}${e?`:${e}`:""}`}const Id="irn";function Qn(t){return t?.relay||{protocol:Id}}function Vr(t){const e=td[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Td=Object.defineProperty,xd=Object.defineProperties,Rd=Object.getOwnPropertyDescriptors,so=Object.getOwnPropertySymbols,Cd=Object.prototype.hasOwnProperty,Ad=Object.prototype.propertyIsEnumerable,oo=(t,e,r)=>e in t?Td(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pd=(t,e)=>{for(var r in e||(e={}))Cd.call(e,r)&&oo(t,r,e[r]);if(so)for(var r of so(e))Ad.call(e,r)&&oo(t,r,e[r]);return t},Ld=(t,e)=>xd(t,Rd(e));function Nd(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),f=t[i];r[s]=f}}),r}function ao(t){t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",f=lr.parse(s);return{protocol:n,topic:Ud(i[0]),version:parseInt(i[1],10),symKey:f.symKey,relay:Nd(f),expiryTimestamp:f.expiryTimestamp?parseInt(f.expiryTimestamp,10):void 0}}function Ud(t){return t.startsWith("//")?t.substring(2):t}function Md(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=r+e+i;t[i]&&(n[s]=t[i])}),n}function $d(t){return`${t.protocol}:${t.topic}@${t.version}?`+lr.stringify(Ld(Pd({symKey:t.symKey},Md(t.relay)),{expiryTimestamp:t.expiryTimestamp}))}const jd={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Fd={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Oe(t,e){const{message:r,code:n}=Fd[t];return{message:e?`${r} ${e}`:r,code:n}}function yr(t,e){const{message:r,code:n}=jd[t];return{message:e?`${r} ${e}`:r,code:n}}function Bd(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Wr(t){return typeof t>"u"}function co(t,e){return e&&Wr(t)?!0:typeof t=="string"&&!!t.trim().length}function zd(t){if(co(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Kd(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function Hd(t){return t?.topic}function Zn(t){return typeof t<"u"&&typeof t!==null}function uo(){const t=Hr();return new Promise(e=>{switch(t){case _t.browser:e(Gd());break;case _t.reactNative:e(Vd());break;case _t.node:e(Wd());break;default:e(!0)}})}function Gd(){return Kr()&&navigator?.onLine}async function Vd(){if(Jt()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function Wd(){return!0}function qd(t){switch(Hr()){case _t.browser:Yd(t);break;case _t.reactNative:kd(t);break}}function Yd(t){!Jt()&&Kr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function kd(t){Jt()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}const ei="wc",fo=2,qr="core",Dt=`${ei}@2:${qr}:`,ho={name:qr,logger:"error"},lo={database:":memory:"},go="crypto",ti="client_ed25519_seed",yo=ae.ONE_DAY,_o="keychain",po="0.3",bo="messages",vo="0.3",wo=ae.SIX_HOURS,mo="publisher",Eo="irn",Do="error",ri="wss://relay.walletconnect.com",ni="wss://relay.walletconnect.org",So="relayer",st={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Oo="_subscription",mt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Io=ae.ONE_SECOND,Xd={database:":memory:"},To="2.11.2",xo=1e4,Ro="0.3",Co="WALLETCONNECT_CLIENT_ID",lt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Jd=ae.THIRTY_DAYS,Ao="subscription",Po="0.3",Lo=ae.FIVE_SECONDS*1e3,No="pairing",Uo="0.3",Qd=ae.THIRTY_DAYS,Qt={wc_pairingDelete:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ae.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ae.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:0},res:{ttl:ae.ONE_DAY,prompt:!1,tag:0}}},_r={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},pt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Mo="history",$o="0.3",jo="expirer",dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Fo="0.3",Zd=ae.ONE_DAY,Yr="verify-api",Zt="https://verify.walletconnect.com",kr="https://verify.walletconnect.org",Bo=[Zt,kr],zo="echo",Ko="https://echo.walletconnect.com";class Ho{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=_o,this.version=po,this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()},this.get=n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=Oe("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=e,this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,to(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ro(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Go{constructor(e,r,n){this.core=e,this.logger=r,this.name=go,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=i=>(this.isInitialized(),this.keychain.has(i)),this.getClientId=async()=>{this.isInitialized();const i=await this.getClientSeed(),s=Cs(i);return Rs(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const i=nd();return this.setPrivateKey(i.publicKey,i.privateKey)},this.signJWT=async i=>{this.isInitialized();const s=await this.getClientSeed(),f=Cs(s),u=Yn();return await hl(u,i,yo,f)},this.generateSharedKey=(i,s,f)=>{this.isInitialized();const u=this.getPrivateKey(i),h=id(u,s);return this.setSymKey(h,f)},this.setSymKey=async(i,s)=>{this.isInitialized();const f=s||sd(i);return await this.keychain.set(f,i),f},this.deleteKeyPair=async i=>{this.isInitialized(),await this.keychain.del(i)},this.deleteSymKey=async i=>{this.isInitialized(),await this.keychain.del(i)},this.encode=async(i,s,f)=>{this.isInitialized();const u=Xs(f),h=rr(s);if(Js(u)){const _=u.senderPublicKey,b=u.receiverPublicKey;i=await this.generateSharedKey(_,b)}const c=this.getSymKey(i),{type:l,senderPublicKey:p}=u;return ad({type:l,symKey:c,message:h,senderPublicKey:p})},this.decode=async(i,s,f)=>{this.isInitialized();const u=fd(s,f);if(Js(u)){const h=u.receiverPublicKey,c=u.senderPublicKey;i=await this.generateSharedKey(h,c)}try{const h=this.getSymKey(i),c=cd({symKey:h,encoded:s});return xr(c)}catch(h){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(h)}},this.getPayloadType=i=>{const s=zr(i);return dr(s.type)},this.getPayloadSenderPublicKey=i=>{const s=zr(i);return s.senderPublicKey?rt(s.senderPublicKey,it):void 0},this.core=e,this.logger=Ee.generateChildLogger(r,this.name),this.keychain=n||new Ho(this.core,this.logger)}get context(){return Ee.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ti)}catch{e=Yn(),await this.keychain.set(ti,e)}return nt(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Vo extends qu{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=bo,this.version=vo,this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,i)=>{this.isInitialized();const s=kn(i);let f=this.messages.get(n);return typeof f>"u"&&(f={}),typeof f[s]<"u"||(f[s]=i,this.messages.set(n,f),await this.persist()),s},this.get=n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i},this.has=(n,i)=>{this.isInitialized();const s=this.get(n),f=kn(i);return typeof s[f]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ee.generateChildLogger(e,this.name),this.core=r}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,to(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ro(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}const eg="PARSE_ERROR",tg="INVALID_REQUEST",rg="METHOD_NOT_FOUND",ng="INVALID_PARAMS",Wo="INTERNAL_ERROR",ii="SERVER_ERROR",ig=[-32700,-32600,-32601,-32602,-32603],pr={[eg]:{code:-32700,message:"Parse error"},[tg]:{code:-32600,message:"Invalid Request"},[rg]:{code:-32601,message:"Method not found"},[ng]:{code:-32602,message:"Invalid params"},[Wo]:{code:-32603,message:"Internal error"},[ii]:{code:-32e3,message:"Server error"}},qo=ii;function sg(t){return ig.includes(t)}function Yo(t){return Object.keys(pr).includes(t)?pr[t]:pr[qo]}function og(t){const e=Object.values(pr).find(r=>r.code===t);return e||pr[qo]}function ag(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var ko={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var si=function(t,e){return si=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},si(t,e)};function cg(t,e){si(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var oi=function(){return oi=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},oi.apply(this,arguments)};function ug(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function fg(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(i<3?f(s):i>3?f(e,r,s):f(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function hg(t,e){return function(r,n){e(r,n,t)}}function lg(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function dg(t,e,r,n){function i(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(n.next(l))}catch(p){f(p)}}function h(l){try{c(n.throw(l))}catch(p){f(p)}}function c(l){l.done?s(l.value):i(l.value).then(u,h)}c((n=n.apply(t,e||[])).next())})}function gg(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function yg(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function _g(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ai(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xo(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],f;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(u){f={error:u}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function pg(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Xo(arguments[e]));return t}function bg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,i++)n[i]=s[f];return n}function br(t){return this instanceof br?(this.v=t,this):new br(t)}function vg(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},f("next"),f("throw"),f("return"),i[Symbol.asyncIterator]=function(){return this},i;function f(_){n[_]&&(i[_]=function(b){return new Promise(function(O,A){s.push([_,b,O,A])>1||u(_,b)})})}function u(_,b){try{h(n[_](b))}catch(O){p(s[0][3],O)}}function h(_){_.value instanceof br?Promise.resolve(_.value.v).then(c,l):p(s[0][2],_)}function c(_){u("next",_)}function l(_){u("throw",_)}function p(_,b){_(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function wg(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(f){return(r=!r)?{value:br(t[i](f)),done:i==="return"}:s?s(f):f}:s}}function mg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ai=="function"?ai(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),i(u,h,f.done,f.value)})}}function i(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function Eg(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Dg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Sg(t){return t&&t.__esModule?t:{default:t}}function Og(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Ig(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Tg=Object.freeze({__proto__:null,__extends:cg,get __assign(){return oi},__rest:ug,__decorate:fg,__param:hg,__metadata:lg,__awaiter:dg,__generator:gg,__createBinding:yg,__exportStar:_g,__values:ai,__read:Xo,__spread:pg,__spreadArrays:bg,__await:br,__asyncGenerator:vg,__asyncDelegator:wg,__asyncValues:mg,__makeTemplateObject:Eg,__importStar:Dg,__importDefault:Sg,__classPrivateFieldGet:Og,__classPrivateFieldSet:Ig}),xg=Lt(Tg),St={},Jo;function Rg(){if(Jo)return St;Jo=1,Object.defineProperty(St,"__esModule",{value:!0}),St.isBrowserCryptoAvailable=St.getSubtleCrypto=St.getBrowerCrypto=void 0;function t(){return ot?.crypto||ot?.msCrypto||{}}St.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}St.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return St.isBrowserCryptoAvailable=r,St}var Ot={},Qo;function Cg(){if(Qo)return Ot;Qo=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.isBrowser=Ot.isNode=Ot.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ot.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ot.isNode=e;function r(){return!t()&&!e()}return Ot.isBrowser=r,Ot}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=xg;e.__exportStar(Rg(),t),e.__exportStar(Cg(),t)})(ko);function Zo(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function ea(t=6){return BigInt(Zo(t))}function ci(t,e,r){return{id:r||Zo(),jsonrpc:"2.0",method:t,params:e}}function ta(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ra(t,e,r){return{id:t,jsonrpc:"2.0",error:Ag(e,r)}}function Ag(t,e){return typeof t>"u"?Yo(Wo):(typeof t=="string"&&(t=Object.assign(Object.assign({},Yo(ii)),{message:t})),typeof e<"u"&&(t.data=e),sg(t.code)&&(t=og(t.code)),t)}class Pg{}class Lg extends Pg{constructor(){super()}}class Ng extends Lg{constructor(e){super()}}const Ug="^wss?:";function Mg(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function $g(t,e){const r=Mg(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function na(t){return $g(t,Ug)}function jg(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function ia(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function sa(t){return ia(t)&&"method"in t}function ui(t){return ia(t)&&(oa(t)||Xr(t))}function oa(t){return"result"in t}function Xr(t){return"error"in t}class Fg extends Ng{constructor(e){super(e),this.events=new ht.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(ci(e.method,e.params||[],e.id||ea().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{Xr(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ui(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Bg=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),zg=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",aa=t=>t.split("?")[0],ca=10,Kg=Bg();class Hg{constructor(e){if(this.url=e,this.events=new ht.exports.EventEmitter,this.registering=!1,!na(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(rr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!na(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=new URLSearchParams(e).get("origin"),s=ko.isReactNative()?{headers:{origin:i}}:{rejectUnauthorized:!jg(e)},f=new Kg(e,[],s);zg()?f.onerror=u=>{const h=u;n(this.emitError(h.error))}:f.on("error",u=>{n(this.emitError(u))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?xr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=ra(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return ag(e,aa(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ca&&this.events.setMaxListeners(ca)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${aa(this.url)}`));return this.events.emit("register_error",r),r}}class Gg extends Yu{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new ht.exports.EventEmitter,this.name=mo,this.queue=new Map,this.publishTimeout=ae.toMiliseconds(ae.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(n,i,s)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});try{const u=s?.ttl||wo,h=Qn(s),c=s?.prompt||!1,l=s?.tag||0,p=s?.id||ea().toString(),_={topic:n,message:i,opts:{ttl:u,relay:h,prompt:c,tag:l,id:p}},b=setTimeout(()=>this.queue.set(p,_),this.publishTimeout);try{await await gr(this.rpcPublish(n,i,u,h,c,l,p),this.publishTimeout,`Failed to publish payload, please try again. id:${p} tag:${l}`),this.removeRequestFromQueue(p),this.relayer.events.emit(st.publish,_)}catch(O){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=s?.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(p),O;return}finally{clearTimeout(b)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.relayer=e,this.logger=Ee.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ee.getLoggerContext(this.logger)}rpcPublish(e,r,n,i,s,f,u){var h,c,l,p;const _={method:Vr(i.protocol).publish,params:{topic:e,message:r,ttl:n,prompt:s,tag:f},id:u};return Wr((h=_.params)==null?void 0:h.prompt)&&((c=_.params)==null||delete c.prompt),Wr((l=_.params)==null?void 0:l.tag)&&((p=_.params)==null||delete p.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:_}),this.relayer.request(_)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:n,opts:i}=e;await this.publish(r,n,i)})}registerEventListeners(){this.relayer.core.heartbeat.on(Wt.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(st.connection_stalled);return}this.checkQueue()}),this.relayer.on(st.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class Vg{constructor(){this.map=new Map,this.set=(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Wg=Object.defineProperty,qg=Object.defineProperties,Yg=Object.getOwnPropertyDescriptors,ua=Object.getOwnPropertySymbols,kg=Object.prototype.hasOwnProperty,Xg=Object.prototype.propertyIsEnumerable,fa=(t,e,r)=>e in t?Wg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vr=(t,e)=>{for(var r in e||(e={}))kg.call(e,r)&&fa(t,r,e[r]);if(ua)for(var r of ua(e))Xg.call(e,r)&&fa(t,r,e[r]);return t},fi=(t,e)=>qg(t,Yg(e));class ha extends Ju{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Vg,this.events=new ht.exports.EventEmitter,this.name=Ao,this.version=Po,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Dt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,i)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const s=Qn(i),f={topic:n,relay:s};this.pending.set(n,f);const u=await this.rpcSubscribe(n,s);return this.onSubscribe(u,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}}),u}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(n,i)=>{await this.restartToComplete(),this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)},this.isSubscribed=async n=>{if(this.topics.includes(n))return!0;const i=`${this.pendingSubscriptionWatchLabel}_${n}`;return await new Promise((s,f)=>{const u=new ae.Watch;u.start(i);const h=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(h),u.stop(i),s(!0)),u.elapsed(i)>=Lo&&(clearInterval(h),u.stop(i),f(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Ee.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=Qn(n);await this.rpcUnsubscribe(e,r,i);const s=yr("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r){const n={method:Vr(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await gr(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(st.connection_stalled)}return kn(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:Vr(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await gr(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(st.connection_stalled)}}rpcUnsubscribe(e,r,n){const i={method:Vr(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,fi(vr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,vr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,vr({},r)),this.topicMap.set(r.topic,e),this.events.emit(lt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(lt.deleted,fi(vr({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(lt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(lt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Bd(r)&&this.onBatchSubscribe(r.map((n,i)=>fi(vr({},e[i]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Wt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(st.connect,async()=>{await this.onConnect()}),this.relayer.on(st.disconnect,()=>{this.onDisconnect()}),this.events.on(lt.created,async e=>{const r=lt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(lt.deleted,async e=>{const r=lt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var Jg=Object.defineProperty,la=Object.getOwnPropertySymbols,Qg=Object.prototype.hasOwnProperty,Zg=Object.prototype.propertyIsEnumerable,da=(t,e,r)=>e in t?Jg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,e0=(t,e)=>{for(var r in e||(e={}))Qg.call(e,r)&&da(t,r,e[r]);if(la)for(var r of la(e))Zg.call(e,r)&&da(t,r,e[r]);return t};class ga extends ku{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ht.exports.EventEmitter,this.name=So,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async r=>{this.logger.debug("Publishing Request Payload");const n=r.id;try{await this.toEstablishConnection();const i=this.provider.request(r);return this.requestsInFlight.set(n,{promise:i,request:r}),await i}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}finally{this.requestsInFlight.delete(n)}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(st.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(st.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(mt.payload,this.onPayloadHandler),this.provider.on(mt.connect,this.onConnectHandler),this.provider.on(mt.disconnect,this.onDisconnectHandler),this.provider.on(mt.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ee.generateChildLogger(e.logger,this.name):Ee.pino(Ee.getDefaultLoggerOptions({level:e.logger||Do})),this.messages=new Vo(this.logger,e.core),this.subscriber=new ha(this,this.logger),this.publisher=new Gg(this,this.logger),this.relayUrl=e?.relayUrl||ri,this.projectId=e.projectId,this.bundleId=_d(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ni}...`),await this.restartTransport(ni)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},xo)}get context(){return Ee.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var n;this.isInitialized();let i=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"";if(i)return i;let s;const f=u=>{u.topic===e&&(this.subscriber.off(lt.created,f),s())};return await Promise.all([new Promise(u=>{s=u,this.subscriber.on(lt.created,f)}),new Promise(async u=>{i=await this.subscriber.subscribe(e,r),u()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async e=>{await e.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await gr(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(lt.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await gr(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(i){n(i);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(mt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await uo())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Fg(new Hg(md({sdkVersion:To,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:n}=e;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.debug(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),sa(e)){if(!e.method.endsWith(Oo))return;const r=e.params,{topic:n,message:i,publishedAt:s}=r.data,f={topic:n,message:i,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(e0({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(e),await this.onMessageEvent(f)}else ui(e)&&this.events.emit(st.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(st.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=ta(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(mt.payload,this.onPayloadHandler),this.provider.off(mt.connect,this.onConnectHandler),this.provider.off(mt.disconnect,this.onDisconnectHandler),this.provider.off(mt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(st.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await uo();qd(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(st.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},ae.toMiliseconds(Io)))}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var hi={exports:{}};(function(t,e){var r=200,n="__lodash_hash_undefined__",i=1,s=2,f=9007199254740991,u="[object Arguments]",h="[object Array]",c="[object AsyncFunction]",l="[object Boolean]",p="[object Date]",_="[object Error]",b="[object Function]",O="[object GeneratorFunction]",A="[object Map]",N="[object Number]",G="[object Null]",E="[object Object]",R="[object Promise]",w="[object Proxy]",m="[object RegExp]",g="[object Set]",o="[object String]",d="[object Symbol]",L="[object Undefined]",P="[object WeakMap]",K="[object ArrayBuffer]",V="[object DataView]",J="[object Float32Array]",I="[object Float64Array]",C="[object Int8Array]",q="[object Int16Array]",F="[object Int32Array]",M="[object Uint8Array]",j="[object Uint8ClampedArray]",U="[object Uint16Array]",B="[object Uint32Array]",ee=/[\\^$.*+?()[\]{}|]/g,z=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,k={};k[J]=k[I]=k[C]=k[q]=k[F]=k[M]=k[j]=k[U]=k[B]=!0,k[u]=k[h]=k[K]=k[l]=k[V]=k[p]=k[_]=k[b]=k[A]=k[N]=k[E]=k[m]=k[g]=k[o]=k[P]=!1;var Z=typeof ot=="object"&&ot&&ot.Object===Object&&ot,x=typeof self=="object"&&self&&self.Object===Object&&self,T=Z||x||Function("return this")(),D=e&&!e.nodeType&&e,a=D&&!0&&t&&!t.nodeType&&t,v=a&&a.exports===D,H=v&&Z.process,Y=function(){try{return H&&H.binding&&H.binding("util")}catch{}}(),he=Y&&Y.isTypedArray;function pe(y,S){for(var $=-1,X=y==null?0:y.length,xe=0,ie=[];++$<X;){var Ne=y[$];S(Ne,$,y)&&(ie[xe++]=Ne)}return ie}function de(y,S){for(var $=-1,X=S.length,xe=y.length;++$<X;)y[xe+$]=S[$];return y}function we(y,S){for(var $=-1,X=y==null?0:y.length;++$<X;)if(S(y[$],$,y))return!0;return!1}function Ue(y,S){for(var $=-1,X=Array(y);++$<y;)X[$]=S($);return X}function Ae(y){return function(S){return y(S)}}function _e(y,S){return y.has(S)}function ge(y,S){return y?.[S]}function le(y){var S=-1,$=Array(y.size);return y.forEach(function(X,xe){$[++S]=[xe,X]}),$}function ue(y,S){return function($){return y(S($))}}function ce(y){var S=-1,$=Array(y.size);return y.forEach(function(X){$[++S]=X}),$}var oe=Array.prototype,se=Function.prototype,te=Object.prototype,fe=T["__core-js_shared__"],ye=se.toString,ne=te.hasOwnProperty,be=function(){var y=/[^.]+$/.exec(fe&&fe.keys&&fe.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),ve=te.toString,De=RegExp("^"+ye.call(ne).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=v?T.Buffer:void 0,me=T.Symbol,bt=T.Uint8Array,Et=te.propertyIsEnumerable,Rt=oe.splice,ut=me?me.toStringTag:void 0,zt=Object.getOwnPropertySymbols,wr=Se?Se.isBuffer:void 0,Qr=ue(Object.keys,Object),Me=er(T,"DataView"),Pe=er(T,"Map"),$e=er(T,"Promise"),je=er(T,"Set"),Fe=er(T,"WeakMap"),Le=er(Object,"create"),He=Ht(Me),Ge=Ht(Pe),Ve=Ht($e),We=Ht(je),qe=Ht(Fe),ze=me?me.prototype:void 0,Be=ze?ze.valueOf:void 0;function Re(y){var S=-1,$=y==null?0:y.length;for(this.clear();++S<$;){var X=y[S];this.set(X[0],X[1])}}function Ye(){this.__data__=Le?Le(null):{},this.size=0}function ke(y){var S=this.has(y)&&delete this.__data__[y];return this.size-=S?1:0,S}function l0(y){var S=this.__data__;if(Le){var $=S[y];return $===n?void 0:$}return ne.call(S,y)?S[y]:void 0}function d0(y){var S=this.__data__;return Le?S[y]!==void 0:ne.call(S,y)}function g0(y,S){var $=this.__data__;return this.size+=this.has(y)?0:1,$[y]=Le&&S===void 0?n:S,this}Re.prototype.clear=Ye,Re.prototype.delete=ke,Re.prototype.get=l0,Re.prototype.has=d0,Re.prototype.set=g0;function It(y){var S=-1,$=y==null?0:y.length;for(this.clear();++S<$;){var X=y[S];this.set(X[0],X[1])}}function y0(){this.__data__=[],this.size=0}function _0(y){var S=this.__data__,$=en(S,y);if($<0)return!1;var X=S.length-1;return $==X?S.pop():Rt.call(S,$,1),--this.size,!0}function p0(y){var S=this.__data__,$=en(S,y);return $<0?void 0:S[$][1]}function b0(y){return en(this.__data__,y)>-1}function v0(y,S){var $=this.__data__,X=en($,y);return X<0?(++this.size,$.push([y,S])):$[X][1]=S,this}It.prototype.clear=y0,It.prototype.delete=_0,It.prototype.get=p0,It.prototype.has=b0,It.prototype.set=v0;function Kt(y){var S=-1,$=y==null?0:y.length;for(this.clear();++S<$;){var X=y[S];this.set(X[0],X[1])}}function w0(){this.size=0,this.__data__={hash:new Re,map:new(Pe||It),string:new Re}}function m0(y){var S=tn(this,y).delete(y);return this.size-=S?1:0,S}function E0(y){return tn(this,y).get(y)}function D0(y){return tn(this,y).has(y)}function S0(y,S){var $=tn(this,y),X=$.size;return $.set(y,S),this.size+=$.size==X?0:1,this}Kt.prototype.clear=w0,Kt.prototype.delete=m0,Kt.prototype.get=E0,Kt.prototype.has=D0,Kt.prototype.set=S0;function Zr(y){var S=-1,$=y==null?0:y.length;for(this.__data__=new Kt;++S<$;)this.add(y[S])}function O0(y){return this.__data__.set(y,n),this}function I0(y){return this.__data__.has(y)}Zr.prototype.add=Zr.prototype.push=O0,Zr.prototype.has=I0;function Ct(y){var S=this.__data__=new It(y);this.size=S.size}function T0(){this.__data__=new It,this.size=0}function x0(y){var S=this.__data__,$=S.delete(y);return this.size=S.size,$}function R0(y){return this.__data__.get(y)}function C0(y){return this.__data__.has(y)}function A0(y,S){var $=this.__data__;if($ instanceof It){var X=$.__data__;if(!Pe||X.length<r-1)return X.push([y,S]),this.size=++$.size,this;$=this.__data__=new Kt(X)}return $.set(y,S),this.size=$.size,this}Ct.prototype.clear=T0,Ct.prototype.delete=x0,Ct.prototype.get=R0,Ct.prototype.has=C0,Ct.prototype.set=A0;function P0(y,S){var $=rn(y),X=!$&&q0(y),xe=!$&&!X&&li(y),ie=!$&&!X&&!xe&&Ma(y),Ne=$||X||xe||ie,Xe=Ne?Ue(y.length,String):[],Qe=Xe.length;for(var Ce in y)(S||ne.call(y,Ce))&&!(Ne&&(Ce=="length"||xe&&(Ce=="offset"||Ce=="parent")||ie&&(Ce=="buffer"||Ce=="byteLength"||Ce=="byteOffset")||K0(Ce,Qe)))&&Xe.push(Ce);return Xe}function en(y,S){for(var $=y.length;$--;)if(Pa(y[$][0],S))return $;return-1}function L0(y,S,$){var X=S(y);return rn(y)?X:de(X,$(y))}function mr(y){return y==null?y===void 0?L:G:ut&&ut in Object(y)?B0(y):W0(y)}function xa(y){return Er(y)&&mr(y)==u}function Ra(y,S,$,X,xe){return y===S?!0:y==null||S==null||!Er(y)&&!Er(S)?y!==y&&S!==S:N0(y,S,$,X,Ra,xe)}function N0(y,S,$,X,xe,ie){var Ne=rn(y),Xe=rn(S),Qe=Ne?h:At(y),Ce=Xe?h:At(S);Qe=Qe==u?E:Qe,Ce=Ce==u?E:Ce;var ft=Qe==E,vt=Ce==E,et=Qe==Ce;if(et&&li(y)){if(!li(S))return!1;Ne=!0,ft=!1}if(et&&!ft)return ie||(ie=new Ct),Ne||Ma(y)?Ca(y,S,$,X,xe,ie):j0(y,S,Qe,$,X,xe,ie);if(!($&i)){var gt=ft&&ne.call(y,"__wrapped__"),yt=vt&&ne.call(S,"__wrapped__");if(gt||yt){var Pt=gt?y.value():y,Tt=yt?S.value():S;return ie||(ie=new Ct),xe(Pt,Tt,$,X,ie)}}return et?(ie||(ie=new Ct),F0(y,S,$,X,xe,ie)):!1}function U0(y){if(!Ua(y)||G0(y))return!1;var S=La(y)?De:z;return S.test(Ht(y))}function M0(y){return Er(y)&&Na(y.length)&&!!k[mr(y)]}function $0(y){if(!V0(y))return Qr(y);var S=[];for(var $ in Object(y))ne.call(y,$)&&$!="constructor"&&S.push($);return S}function Ca(y,S,$,X,xe,ie){var Ne=$&i,Xe=y.length,Qe=S.length;if(Xe!=Qe&&!(Ne&&Qe>Xe))return!1;var Ce=ie.get(y);if(Ce&&ie.get(S))return Ce==S;var ft=-1,vt=!0,et=$&s?new Zr:void 0;for(ie.set(y,S),ie.set(S,y);++ft<Xe;){var gt=y[ft],yt=S[ft];if(X)var Pt=Ne?X(yt,gt,ft,S,y,ie):X(gt,yt,ft,y,S,ie);if(Pt!==void 0){if(Pt)continue;vt=!1;break}if(et){if(!we(S,function(Tt,Gt){if(!_e(et,Gt)&&(gt===Tt||xe(gt,Tt,$,X,ie)))return et.push(Gt)})){vt=!1;break}}else if(!(gt===yt||xe(gt,yt,$,X,ie))){vt=!1;break}}return ie.delete(y),ie.delete(S),vt}function j0(y,S,$,X,xe,ie,Ne){switch($){case V:if(y.byteLength!=S.byteLength||y.byteOffset!=S.byteOffset)return!1;y=y.buffer,S=S.buffer;case K:return!(y.byteLength!=S.byteLength||!ie(new bt(y),new bt(S)));case l:case p:case N:return Pa(+y,+S);case _:return y.name==S.name&&y.message==S.message;case m:case o:return y==S+"";case A:var Xe=le;case g:var Qe=X&i;if(Xe||(Xe=ce),y.size!=S.size&&!Qe)return!1;var Ce=Ne.get(y);if(Ce)return Ce==S;X|=s,Ne.set(y,S);var ft=Ca(Xe(y),Xe(S),X,xe,ie,Ne);return Ne.delete(y),ft;case d:if(Be)return Be.call(y)==Be.call(S)}return!1}function F0(y,S,$,X,xe,ie){var Ne=$&i,Xe=Aa(y),Qe=Xe.length,Ce=Aa(S),ft=Ce.length;if(Qe!=ft&&!Ne)return!1;for(var vt=Qe;vt--;){var et=Xe[vt];if(!(Ne?et in S:ne.call(S,et)))return!1}var gt=ie.get(y);if(gt&&ie.get(S))return gt==S;var yt=!0;ie.set(y,S),ie.set(S,y);for(var Pt=Ne;++vt<Qe;){et=Xe[vt];var Tt=y[et],Gt=S[et];if(X)var $a=Ne?X(Gt,Tt,et,S,y,ie):X(Tt,Gt,et,y,S,ie);if(!($a===void 0?Tt===Gt||xe(Tt,Gt,$,X,ie):$a)){yt=!1;break}Pt||(Pt=et=="constructor")}if(yt&&!Pt){var nn=y.constructor,sn=S.constructor;nn!=sn&&"constructor"in y&&"constructor"in S&&!(typeof nn=="function"&&nn instanceof nn&&typeof sn=="function"&&sn instanceof sn)&&(yt=!1)}return ie.delete(y),ie.delete(S),yt}function Aa(y){return L0(y,X0,z0)}function tn(y,S){var $=y.__data__;return H0(S)?$[typeof S=="string"?"string":"hash"]:$.map}function er(y,S){var $=ge(y,S);return U0($)?$:void 0}function B0(y){var S=ne.call(y,ut),$=y[ut];try{y[ut]=void 0;var X=!0}catch{}var xe=ve.call(y);return X&&(S?y[ut]=$:delete y[ut]),xe}var z0=zt?function(y){return y==null?[]:(y=Object(y),pe(zt(y),function(S){return Et.call(y,S)}))}:J0,At=mr;(Me&&At(new Me(new ArrayBuffer(1)))!=V||Pe&&At(new Pe)!=A||$e&&At($e.resolve())!=R||je&&At(new je)!=g||Fe&&At(new Fe)!=P)&&(At=function(y){var S=mr(y),$=S==E?y.constructor:void 0,X=$?Ht($):"";if(X)switch(X){case He:return V;case Ge:return A;case Ve:return R;case We:return g;case qe:return P}return S});function K0(y,S){return S=S??f,!!S&&(typeof y=="number"||Q.test(y))&&y>-1&&y%1==0&&y<S}function H0(y){var S=typeof y;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?y!=="__proto__":y===null}function G0(y){return!!be&&be in y}function V0(y){var S=y&&y.constructor,$=typeof S=="function"&&S.prototype||te;return y===$}function W0(y){return ve.call(y)}function Ht(y){if(y!=null){try{return ye.call(y)}catch{}try{return y+""}catch{}}return""}function Pa(y,S){return y===S||y!==y&&S!==S}var q0=xa(function(){return arguments}())?xa:function(y){return Er(y)&&ne.call(y,"callee")&&!Et.call(y,"callee")},rn=Array.isArray;function Y0(y){return y!=null&&Na(y.length)&&!La(y)}var li=wr||Q0;function k0(y,S){return Ra(y,S)}function La(y){if(!Ua(y))return!1;var S=mr(y);return S==b||S==O||S==c||S==w}function Na(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=f}function Ua(y){var S=typeof y;return y!=null&&(S=="object"||S=="function")}function Er(y){return y!=null&&typeof y=="object"}var Ma=he?Ae(he):M0;function X0(y){return Y0(y)?P0(y):$0(y)}function J0(){return[]}function Q0(){return!1}t.exports=k0})(hi,hi.exports);var t0=hi.exports,r0=Object.defineProperty,ya=Object.getOwnPropertySymbols,n0=Object.prototype.hasOwnProperty,i0=Object.prototype.propertyIsEnumerable,_a=(t,e,r)=>e in t?r0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pa=(t,e)=>{for(var r in e||(e={}))n0.call(e,r)&&_a(t,r,e[r]);if(ya)for(var r of ya(e))i0.call(e,r)&&_a(t,r,e[r]);return t};class ba extends Xu{constructor(e,r,n,i=Dt,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,this.map=new Map,this.version=Ro,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!Wr(f)?this.map.set(this.getKey(f),f):Kd(f)?this.map.set(f.id,f):Hd(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,u)=>{this.isInitialized(),this.map.has(f)?await this.update(f,u):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:u}),this.map.set(f,u),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(u=>Object.keys(f).every(h=>t0(u[h],f[h]))):this.values),this.update=async(f,u)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:u});const h=pa(pa({},this.getData(f)),u);this.map.set(f,h),await this.persist()},this.delete=async(f,u)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:u}),this.map.delete(f),await this.persist())},this.logger=Ee.generateChildLogger(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:n}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class va{constructor(e,r){this.core=e,this.logger=r,this.name=No,this.version=Uo,this.events=new ht.exports,this.initialized=!1,this.storagePrefix=Dt,this.ignoredPayloadTypes=[Xt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Yn(),i=await this.core.crypto.setSymKey(n),s=Gr(ae.FIVE_MINUTES),f={protocol:Eo},u={topic:i,expiry:s,relay:f,active:!1},h=$d({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:n,relay:f,expiryTimestamp:s});return await this.pairings.set(i,u),await this.core.relayer.subscribe(i),this.core.expirer.set(i,s),{topic:i,uri:h}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:i,symKey:s,relay:f,expiryTimestamp:u}=ao(n.uri);let h;if(this.pairings.keys.includes(i)&&(h=this.pairings.get(i),h.active))throw new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);const c=u||Gr(ae.FIVE_MINUTES),l={topic:i,relay:f,expiry:c,active:!1};return await this.pairings.set(i,l),this.core.expirer.set(i,c),n.activatePairing&&await this.activate({topic:i}),this.events.emit(_r.create,l),this.core.crypto.keychain.has(i)||(await this.core.crypto.setSymKey(s,i),await this.core.relayer.subscribe(i,{relay:f})),l},this.activate=async({topic:n})=>{this.isInitialized();const i=Gr(ae.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:i}),this.core.expirer.set(n,i)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:f,resolve:u,reject:h}=Ed();this.events.once(Jn("pairing_ping",s),({error:c})=>{c?h(c):u()}),await f()}},this.updateExpiry=async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})},this.updateMetadata=async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",yr("USER_DISCONNECTED")),await this.deletePairing(i))},this.sendRequest=async(n,i,s)=>{const f=ci(i,s),u=await this.core.crypto.encode(n,f),h=Qt[i].req;return this.core.history.set(n,f),this.core.relayer.publish(n,u,h),f.id},this.sendResult=async(n,i,s)=>{const f=ta(n,s),u=await this.core.crypto.encode(i,f),h=await this.core.history.get(i,n),c=Qt[h.request.method].res;await this.core.relayer.publish(i,u,c),await this.core.history.resolve(f)},this.sendError=async(n,i,s)=>{const f=ra(n,s),u=await this.core.crypto.encode(i,f),h=await this.core.history.get(i,n),c=Qt[h.request.method]?Qt[h.request.method].res:Qt.unregistered_method.res;await this.core.relayer.publish(i,u,c),await this.core.history.resolve(f)},this.deletePairing=async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,yr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(i=>io(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))},this.onRelayEventRequest=n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(i,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(i,s);default:return this.onUnknownRpcMethodRequest(i,s)}},this.onRelayEventResponse=async n=>{const{topic:i,payload:s}=n,f=(await this.core.history.get(i,s.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(_r.ping,{id:s,topic:n})}catch(f){await this.sendError(s,n,f),this.logger.error(f)}},this.onPairingPingResponse=(n,i)=>{const{id:s}=i;setTimeout(()=>{oa(i)?this.events.emit(Jn("pairing_ping",s),{}):Xr(i)&&this.events.emit(Jn("pairing_ping",s),{error:i.error})},500)},this.onPairingDeleteRequest=async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(_r.delete,{id:s,topic:n})}catch(f){await this.sendError(s,n,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(n,i)=>{const{id:s,method:f}=i;try{if(this.registeredMethods.includes(f))return;const u=yr("WC_METHOD_UNSUPPORTED",f);await this.sendError(s,n,u),this.logger.error(u)}catch(u){await this.sendError(s,n,u),this.logger.error(u)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(yr("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var i;if(!Zn(n)){const{message:f}=Oe("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(f)}if(!zd(n.uri)){const{message:f}=Oe("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(f)}const s=ao(n.uri);if(!((i=s?.relay)!=null&&i.protocol)){const{message:f}=Oe("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(s!=null&&s.symKey)){const{message:f}=Oe("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}if(s!=null&&s.expiryTimestamp&&ae.toMiliseconds(s?.expiryTimestamp)<Date.now()){const{message:f}=Oe("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(f)}},this.isValidPing=async n=>{if(!Zn(n)){const{message:s}=Oe("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)},this.isValidDisconnect=async n=>{if(!Zn(n)){const{message:s}=Oe("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)},this.isValidPairingTopic=async n=>{if(!co(n,!1)){const{message:i}=Oe("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=Oe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(io(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=Oe("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}},this.core=e,this.logger=Ee.generateChildLogger(r,this.name),this.pairings=new ba(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ee.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(st.message,async e=>{const{topic:r,message:n}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const i=await this.core.crypto.decode(r,n);try{sa(i)?(this.core.history.set(r,i),this.onRelayEventRequest({topic:r,payload:i})):ui(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(dt.expired,async e=>{const{topic:r}=Od(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(_r.expire,{topic:r}))})}}class wa extends Wu{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new ht.exports.EventEmitter,this.name=Mo,this.version=$o,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const f={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:Gr(ae.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(pt.created,f)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=Xr(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.events.emit(pt.updated,i))},this.get=async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i)),this.delete=(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(pt.deleted,s)}})},this.exists=async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1),this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:ci(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(pt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(pt.created,e=>{const r=pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(pt.updated,e=>{const r=pt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(pt.deleted,e=>{const r=pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(Wt.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{ae.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ma extends Qu{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new ht.exports.EventEmitter,this.name=jo,this.version=Fo,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}},this.set=(n,i)=>{this.isInitialized();const s=this.formatTarget(n),f={target:s,expiry:i};this.expirations.set(s,f),this.checkExpiry(s,f),this.events.emit(dt.created,{target:s,expiration:f})},this.get=n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)},this.del=n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(dt.deleted,{target:i,expiration:s})}},this.on=(n,i)=>{this.events.on(n,i)},this.once=(n,i)=>{this.events.once(n,i)},this.off=(n,i)=>{this.events.off(n,i)},this.removeListener=(n,i)=>{this.events.removeListener(n,i)},this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Dd(e);if(typeof e=="number")return Sd(e);const{message:r}=Oe("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;ae.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(dt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Wt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(dt.created,e=>{const r=dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(dt.expired,e=>{const r=dt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(dt.deleted,e=>{const r=dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ea extends Zu{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=Yr,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||Jt()||!Kr())return;const i=this.getVerifyUrl(n?.verifyUrl);this.verifyUrl!==i&&this.removeIframe(),this.verifyUrl=i;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=kr;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const i=this.getVerifyUrl(n?.verifyUrl);let s;try{s=await this.fetchAttestation(n.attestationId,i)}catch(f){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${i}`),this.logger.info(f),s=await this.fetchAttestation(n.attestationId,kr)}return s},this.fetchAttestation=async(n,i)=>{this.logger.info(`resolving attestation: ${n} from url: ${i}`);const s=this.startAbortTimer(ae.ONE_SECOND*2),f=await fetch(`${i}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(s),f.status===200?await f.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var i;try{if(!this.iframe)return;(i=this.iframe.contentWindow)==null||i.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const i=s=>{s.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",i),n())};await Promise.race([new Promise(s=>{if(document.getElementById(Yr))return s();window.addEventListener("message",i);const f=document.createElement("iframe");f.id=Yr,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,n=s}),new Promise((s,f)=>setTimeout(()=>{window.removeEventListener("message",i),f("verify iframe load timeout")},ae.toMiliseconds(ae.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let i=n||Zt;return Bo.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${Zt}`),i=Zt),i},this.logger=Ee.generateChildLogger(r,this.name),this.verifyUrl=Zt,this.abortController=new AbortController,this.isDevEnv=Xn()&&process.env.IS_VITEST}get context(){return Ee.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ae.toMiliseconds(e))}}function s0(t,e){return e=e||{},new Promise(function(r,n){var i=new XMLHttpRequest,s=[],f=[],u={},h=function(){return{ok:(i.status/100|0)==2,statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:h,headers:{keys:function(){return s},entries:function(){return f},get:function(l){return u[l.toLowerCase()]},has:function(l){return l.toLowerCase()in u}}}};for(var c in i.open(e.method||"get",t,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(l,p,_){s.push(p=p.toLowerCase()),f.push([p,_]),u[p]=u[p]?u[p]+","+_:_}),r(h())},i.onerror=n,i.withCredentials=e.credentials=="include",e.headers)i.setRequestHeader(c,e.headers[c]);i.send(e.body||null)})}var o0=Object.freeze({__proto__:null,default:s0}),Da=Lt(o0),a0=self.fetch||(self.fetch=Da.default||Da);class Sa extends ef{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=zo,this.registerDeviceToken=async n=>{const{clientId:i,token:s,notificationType:f,enableEncrypted:u=!1}=n,h=`${Ko}/${this.projectId}/clients`;await a0(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:f,token:s,always_raw:u})})},this.logger=Ee.generateChildLogger(r,this.context)}}var c0=Object.defineProperty,Oa=Object.getOwnPropertySymbols,u0=Object.prototype.hasOwnProperty,f0=Object.prototype.propertyIsEnumerable,Ia=(t,e,r)=>e in t?c0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ta=(t,e)=>{for(var r in e||(e={}))u0.call(e,r)&&Ia(t,r,e[r]);if(Oa)for(var r of Oa(e))f0.call(e,r)&&Ia(t,r,e[r]);return t};class Jr extends Vu{constructor(e){super(e),this.protocol=ei,this.version=fo,this.name=qr,this.events=new ht.exports.EventEmitter,this.initialized=!1,this.on=(n,i)=>this.events.on(n,i),this.once=(n,i)=>this.events.once(n,i),this.off=(n,i)=>this.events.off(n,i),this.removeListener=(n,i)=>this.events.removeListener(n,i),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||ri,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:e?.logger||ho.logger}));this.logger=Ee.generateChildLogger(r,this.name),this.heartbeat=new Wt.HeartBeat,this.crypto=new Go(this,this.logger,e?.keychain),this.history=new wa(this,this.logger),this.expirer=new ma(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new mc(Ta(Ta({},lo),e?.storageOptions)),this.relayer=new ga({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new va(this,this.logger),this.verify=new Ea(this.projectId||"",this.logger),this.echoClient=new Sa(this.projectId||"",this.logger)}static async init(e){const r=new Jr(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(Co,n),r}get context(){return Ee.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const h0=Jr;W.CORE_CONTEXT=qr,W.CORE_DEFAULT=ho,W.CORE_PROTOCOL=ei,W.CORE_STORAGE_OPTIONS=lo,W.CORE_STORAGE_PREFIX=Dt,W.CORE_VERSION=fo,W.CRYPTO_CLIENT_SEED=ti,W.CRYPTO_CONTEXT=go,W.CRYPTO_JWT_TTL=yo,W.Core=h0,W.Crypto=Go,W.ECHO_CONTEXT=zo,W.ECHO_URL=Ko,W.EXPIRER_CONTEXT=jo,W.EXPIRER_DEFAULT_TTL=Zd,W.EXPIRER_EVENTS=dt,W.EXPIRER_STORAGE_VERSION=Fo,W.EchoClient=Sa,W.Expirer=ma,W.HISTORY_CONTEXT=Mo,W.HISTORY_EVENTS=pt,W.HISTORY_STORAGE_VERSION=$o,W.JsonRpcHistory=wa,W.KEYCHAIN_CONTEXT=_o,W.KEYCHAIN_STORAGE_VERSION=po,W.KeyChain=Ho,W.MESSAGES_CONTEXT=bo,W.MESSAGES_STORAGE_VERSION=vo,W.MessageTracker=Vo,W.PAIRING_CONTEXT=No,W.PAIRING_DEFAULT_TTL=Qd,W.PAIRING_EVENTS=_r,W.PAIRING_RPC_OPTS=Qt,W.PAIRING_STORAGE_VERSION=Uo,W.PENDING_SUB_RESOLUTION_TIMEOUT=Lo,W.PUBLISHER_CONTEXT=mo,W.PUBLISHER_DEFAULT_TTL=wo,W.Pairing=va,W.RELAYER_CONTEXT=So,W.RELAYER_DEFAULT_LOGGER=Do,W.RELAYER_DEFAULT_PROTOCOL=Eo,W.RELAYER_DEFAULT_RELAY_URL=ri,W.RELAYER_EVENTS=st,W.RELAYER_FAILOVER_RELAY_URL=ni,W.RELAYER_PROVIDER_EVENTS=mt,W.RELAYER_RECONNECT_TIMEOUT=Io,W.RELAYER_SDK_VERSION=To,W.RELAYER_STORAGE_OPTIONS=Xd,W.RELAYER_SUBSCRIBER_SUFFIX=Oo,W.RELAYER_TRANSPORT_CUTOFF=xo,W.Relayer=ga,W.STORE_STORAGE_VERSION=Ro,W.SUBSCRIBER_CONTEXT=Ao,W.SUBSCRIBER_DEFAULT_TTL=Jd,W.SUBSCRIBER_EVENTS=lt,W.SUBSCRIBER_STORAGE_VERSION=Po,W.Store=ba,W.Subscriber=ha,W.TRUSTED_VERIFY_URLS=Bo,W.VERIFY_CONTEXT=Yr,W.VERIFY_FALLBACK_SERVER=kr,W.VERIFY_SERVER=Zt,W.Verify=Ea,W.WALLETCONNECT_CLIENT_ID=Co,W.default=Jr,Object.defineProperty(W,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
