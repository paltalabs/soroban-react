import{EventType as e}from"./interfaces.js";class r{constructor(){this.isConnected=!1}sendEventToContentScript(e,r,o){return new Promise((t=>{const n=e=>{if(e.source!==window||!e.data||e.origin!==window.origin)return;e.data.eventId===o&&(t(e),window.removeEventListener("message",n,!1))};window.addEventListener("message",n,!1),window.webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({type:e,eventId:o,detail:r}))}))}async enableConnection(){const r={origin:window.origin,host:window.location.host,permissions:{canRequestPublicKey:!0,canRequestSign:!0}},o=await this.sendEventToContentScript(e.XBULL_CONNECT,r,crypto.randomUUID()),{detail:t}=o.data;if(!t||t.error)throw{code:t?.code||-1,message:t?.errorMessage||"Unexpected error"};this.isConnected=!0}async getAddress(){try{await this.enableConnection()}catch(e){return{error:{code:e?.code||-1,message:e?.message||"Unexpected error"}}}const r={origin:window.origin,host:window.location.host},o=await this.sendEventToContentScript(e.XBULL_GET_PUBLIC_KEY,r,crypto.randomUUID()),{detail:t}=o.data;return!t||t.error?{error:{code:t?.code||-1,message:t?.errorMessage||"Unexpected error"}}:{address:t.payload}}async signTransaction(r){if(r.opts?.submit||r.opts?.submitUrl)return{error:{code:-1,message:"Parameters `submit` and `submitUrl` are not supported"}};try{await this.enableConnection()}catch(e){return{error:{code:e?.code||-1,message:e?.message||"Unexpected error"}}}const o={origin:window.origin,host:window.location.host,network:r.opts?.networkPassphrase,publicKey:r.opts?.address,xdr:r.xdr,xdrType:"Transaction"},t=await this.sendEventToContentScript(e.XBULL_SIGN_XDR,o,crypto.randomUUID()),{detail:n}=t.data;return!n||n.error?{error:{code:n?.code||-1,message:n?.errorMessage||"Unexpected error"}}:{signedTxXdr:n.payload.signedXdr,signerAddress:n.payload.signerAddress}}async getNetwork(){try{await this.enableConnection()}catch(e){return{error:{code:e?.code||-1,message:e?.message||"Unexpected error"}}}const r={origin:window.origin,host:window.location.host},o=await this.sendEventToContentScript(e.XBULL_GET_NETWORK,r,crypto.randomUUID()),{detail:t}=o.data;return!t||t.error?{error:{code:t?.code||-1,message:t?.errorMessage||"Unexpected error"}}:{network:t.payload.network,networkPassphrase:t.payload.networkPassphrase}}}export{r as xBullSDK};
//# sourceMappingURL=mobile-sdk.js.map
