"use strict";var e=require("./state/store.cjs");exports.StellarWalletsKit=class{get selectedModule(){const t=this.modules.find((t=>t.productId===e.store.getValue().selectedModuleId));if(!t)throw{code:-3,message:"Please set the wallet first"};return t}constructor(t){this.modules=t.modules,this.setWallet(t.selectedWalletId),e.setNetwork(t.network);const s=t.theme||t.modalTheme;s&&e.setModalTheme(s),t.buttonTheme&&e.seButtonTheme(t.buttonTheme),this.getSupportedWallets().then((t=>{e.setAllowedWallets(t)}))}async getSupportedWallets(){return Promise.all(this.modules.map((async e=>{const t=new Promise((e=>setTimeout((()=>e(!1)),500)));return{id:e.productId,name:e.productName,type:e.moduleType,icon:e.productIcon,isAvailable:await Promise.race([t,e.isAvailable()]),url:e.productUrl}})))}setWallet(t){const s=this.modules.find((e=>e.productId===t));if(!s)throw new Error(`Wallet id "${t}" is not supported`);e.setSelectedModuleId(s.productId)}async getAddress(t){const{address:s}=await this.selectedModule.getAddress(t);return e.setAddress(s),{address:s}}async signTransaction(t,s){return this.selectedModule.signTransaction(t,{...s,networkPassphrase:s?.networkPassphrase||e.store.getValue().selectedNetwork})}async signAuthEntry(t,s){return this.selectedModule.signAuthEntry(t,{...s,networkPassphrase:s?.networkPassphrase||e.store.getValue().selectedNetwork})}async signMessage(t,s){return this.selectedModule.signMessage(t,{...s,networkPassphrase:s?.networkPassphrase||e.store.getValue().selectedNetwork})}async getNetwork(){return this.selectedModule.getNetwork()}async disconnect(){e.removeAddress()}isButtonCreated(){return!!this.buttonElement}assignButtons(t){const s="string"==typeof t.connectEl?document.querySelector(t.connectEl):t.connectEl;if(!s)throw new Error("connectEl is not available");if(s.addEventListener("click",(()=>{this.openModal({onWalletSelected:s=>{e.setSelectedModuleId(s.id),this.getAddress().then((e=>t.onConnect(e)))}}).then()}),!1),!t.disconnectEl)return;const n="string"==typeof t.disconnectEl?document.querySelector(t.disconnectEl):t.disconnectEl;if(!n)throw new Error("disconnectEl is not available");n.addEventListener("click",(()=>{t.onDisconnect(),e.removeAddress(),this.selectedModule.disconnect&&this.selectedModule.disconnect().then()}),!1)}async createButton(t){if(this.buttonElement)throw new Error("Stellar Wallets Kit button is already created");this.buttonElement=document.createElement("stellar-wallets-button"),t.buttonText&&this.buttonElement.setAttribute("buttonText",t.buttonText),t.horizonUrl&&e.setHorizonUrl(t.horizonUrl),t.container.appendChild(this.buttonElement),this.buttonElement.addEventListener("button-clicked",(()=>{this.openModal({onWalletSelected:s=>{e.setSelectedModuleId(s.id),this.getAddress().then((e=>t.onConnect(e)))}})}),!1),this.buttonElement.addEventListener("disconnect-wallet",(()=>{t.onDisconnect(),this.selectedModule.disconnect&&this.selectedModule.disconnect()}),!1)}async removeButton(e){if(!this.buttonElement)throw new Error("Stellar Wallets Kit button hasn't been created yet");!0!==e?.skipDisconnect&&this.buttonElement.disconnect(),this.buttonElement.remove(),delete this.buttonElement}async openModal(e){if(this.modalElement&&!this.buttonElement)throw new Error("Stellar Wallets Kit modal is already open");this.modalElement=document.createElement("stellar-wallets-modal"),this.modalElement.setAttribute("showModal",""),e.modalTitle&&this.modalElement.setAttribute("modalTitle",e.modalTitle),e.notAvailableText&&this.modalElement.setAttribute("notAvailableText",e.notAvailableText),document.body.appendChild(this.modalElement);const t=s=>{e.onWalletSelected(s.detail),this.modalElement.removeEventListener("wallet-selected",t,!1),document.body.removeChild(this.modalElement),this.modalElement=void 0};this.modalElement.addEventListener("wallet-selected",t,!1);const s=n=>{e.onClosed&&e.onClosed(n.detail),this.modalElement.removeEventListener("wallet-selected",t,!1),this.modalElement.removeEventListener("modal-closed",s,!1),document.body.removeChild(this.modalElement),this.modalElement=void 0};this.modalElement.addEventListener("modal-closed",s,!1)}};
//# sourceMappingURL=stellar-wallets-kit.cjs.map
